   Link: next: Preface
   Red Hat V2V 0.1

                                   V2V Guide

Migrating VMware to Red Hat Virtualization

  Red Hat V2V Documentation Team

   v2v-docs@redhat.com

   Abstract

   This document describes the infrastructure migration solution for VMware.

     ----------------------------------------------------------------------

     * Preface
     * 1. Introduction
     * 2. Requirements
          * 2.1. Red Hat Virtualization Manager Requirements
          * 2.2. Installing Red Hat Virtualization Manager
               * 2.2.1. Configuring the Red Hat Virtualization Manager
               * 2.2.2. Connecting to the Administration Portal
          * 2.3. Installing Hosts
          * 2.4. Attaching Storage
          * 2.5. Installing Red Hat CloudForms
     * 3. Discovery
     * 4. Planning
     * 5. Migration
     * 6. Post-migration

                                    Preface

   This draft is a work in progress and internal only.

     o Content Plan
     o Google docs version for comments
     o GA date: August 14, 2018
     o Contacts: Steve Bream (CS), Avital Pinnick (TW)

                            Chapter 1. Introduction

   Red Hat V2V is Red Hat’s infrastructure migration solution for moving your
   VMware environment to Red Hat Virtualization. [To be expanded]

   Red Hat Virtualization is an enterprise-grade virtualization platform
   built on Red Hat Enterprise Linux. Virtualization allows users to easily
   provision new virtual servers and workstations, and provides more
   efficient use of physical server resources. With Red Hat Virtualization,
   you can manage your entire virtual infrastructure, including hosts,
   virtual machines, networks, storage, and users, from a centralized
   graphical user interface or with a REST API.

   The migration process is performed with Red Hat CloudForms. CloudForms
   provides the control and automation that enterprises require to manage
   challenging virtual environments.

   The entire migration process comprises the following stages:

     o Discovery
     o Planning
     o Migration
     o Post-migration

                            Chapter 2. Requirements

2.1. Red Hat Virtualization Manager Requirements

   Note

   The hardware requirements are based on a typical small to medium-sized
   installation. The exact requirements vary between deployments based on
   sizing and load.

   Your system must have the following in order to install the Red Hat
   Virtualization Manager:

     o Hardware:

          o CPU - Minimum: dual core. Recommended: quad core or multiple dual
            core CPUs.
          o System RAM - Minimum: 4 GB. Recommended: 16 GB.
          o Hard disk (locally accessible and writable) - Minimum: 25 GB.
            Recommended: 50 GB.
          o Network Interface Card (NIC) - Minimum and recommended: Bandwidth
            of at least 1 Gbps.
     o Browser: Latest version of Internet Explorer, Firefox, or Chrome.
     o Operating system: Red Hat Enterprise Linux 7, updated to the latest
       minor release.

       Do not install any additional packages after the base installation, as
       they may cause dependency issues when attempting to install the
       packages required by the Manager.

       Do not enable additional repositories. The required repositories are
       specified in Section 2.2, “Installing Red Hat Virtualization Manager”.

2.2. Installing Red Hat Virtualization Manager

   Enabling the Manager Repositories

   To install the Red Hat Virtualization packages, you must register the
   system with Red Hat Subscription Manager, attach the Red Hat Enterprise
   Linux Server and Red Hat Virtualization subscriptions, and enable the
   Manager repositories.

    1. Register your system with the Content Delivery Network, entering your
       Customer Portal user name and password when prompted:

 # subscription-manager register

    2. Find the Red Hat Enterprise Linux Server and Red Hat Virtualization
       subscription pools and note down the pool IDs:

 # subscription-manager list --available

    3. Use the pool IDs to attach the subscriptions to the system:

 # subscription-manager attach --pool=pool_id

       Note

       To find out which subscriptions are currently attached, run:

 # subscription-manager list --consumed

       To list all enabled repositories, run:

 # yum repolist

    4. Disable all existing repositories:

 # subscription-manager repos --disable=*

    5. Enable the required repositories:

 # subscription-manager repos --enable=rhel-7-server-rpms
 # subscription-manager repos --enable=rhel-7-server-supplementary-rpms
 # subscription-manager repos --enable=rhel-7-server-rhv-4.2-manager-rpms
 # subscription-manager repos --enable=rhel-7-server-rhv-4-manager-tools-rpms
 # subscription-manager repos --enable=rhel-7-server-ansible-2-rpms
 # subscription-manager repos --enable=jb-eap-7-for-rhel-7-server-rpms

   Installing the Manager Packages

    1. To ensure all packages are up to date, run the following command on
       the machine where you are installing the Red Hat Virtualization
       Manager:

 # yum update

       Note

       Reboot the machine if any kernel related packages have been updated.

    2. Run the following command to install the rhvm package and
       dependencies.

 # yum install rhvm

   Proceed to the next step to configure your Red Hat Virtualization Manager.

   Configuring the Manager

   After you have installed the rhvm package and dependencies, you must
   configure the Manager using the engine-setup command. This command asks
   you a series of questions and, after you provide the required values for
   all questions, applies that configuration and starts the ovirt-engine
   service. engine-setup creates and configures the Manager database locally
   on the Manager machine.

   Important

   The engine-setup command guides you through several distinct configuration
   stages, each comprising several steps that require user input. Suggested
   configuration defaults are provided in square brackets; if the suggested
   value is acceptable for a given step, press Enter to accept that value.

   You can run engine-setup --accept-defaults to automatically accept all
   questions that have default answers. This option should be used with
   caution and only if you are familiar with engine-setup.

    1. Run the engine-setup command to begin configuration:

 # engine-setup

    2. Press Enter to configure the Manager:

 Configure Engine on this host (Yes, No) [Yes]:

    3. Optionally allow engine-setup to configure the Image I/O Proxy
       (ovirt-imageio-proxy) to allow the Manager to upload virtual disks
       into storage domains.

 Configure Image I/O Proxy on this host? (Yes, No) [Yes]:

    4. Optionally allow engine-setup to configure a websocket proxy server
       for allowing users to connect to virtual machines via the noVNC or
       HTML 5 consoles:

 Configure WebSocket Proxy on this machine? (Yes, No) [Yes]:

    1. Choose whether to configure Data Warehouse on the Manager machine.

 Please note: Data Warehouse is required for the engine. If you choose to not configure it on this host, you have to configure it on a remote host, and then configure the engine on this host so that it can access the database of the remote Data Warehouse host.
 Configure Data Warehouse on this host (Yes, No) [Yes]:

       To configure Data Warehouse on a separate machine, select No and see
       Installing and Configuring Data Warehouse on a Separate Machine in the
       Data Warehouse Guide for installation and configuration instructions.

    2. Optionally allow access to a virtual machines’s serial console from
       the command line.

 Configure VM Console Proxy on this host (Yes, No) [Yes]:

       Additional configuration is required on the client machine to use this
       feature. See Opening a Serial Console to a Virtual Machine in the
       Virtual Machine Management Guide.

    3. Optionally install Open Virtual Network (OVN). Selecting Yes will
       install an OVN central server on the Manager machine, and add it to
       Red Hat Virtualization as an external network provider. The default
       cluster will use OVN as its default network provider, and hosts added
       to the default cluster will automatically be configured to communicate
       with OVN.

 Configure ovirt-provider-ovn (Yes, No) [Yes]:

       For more information on using OVN networks in Red Hat Virtualization,
       see Adding Open Virtual Network (OVN) as an External Network Provider
       in the Administration Guide.

    4. Press Enter to accept the automatically detected host name, or enter
       an alternative host name and press Enter. Note that the automatically
       detected host name may be incorrect if you are using virtual hosts.

 Host fully qualified DNS name of this server [autodetected host name]:

    5. The engine-setup command checks your firewall configuration and offers
       to modify that configuration to open the ports used by the Manager for
       external communication such as TCP ports 80 and 443. If you do not
       allow engine-setup to modify your firewall configuration, then you
       must manually open the ports used by the Manager. Firewalld will be
       configured as the firewall manager because iptables have been
       deprecated.

 Setup can automatically configure the firewall on this system.
 Note: automatic configuration of the firewall may overwrite current settings.
 NOTICE: iptables is deprecated and will be removed in future releases
 Do you want Setup to configure the firewall? (Yes, No) [Yes]:

       If you choose to automatically configure the firewall, and no firewall
       managers are active, you are prompted to select your chosen firewall
       manager from a list of supported options. Type the name of the
       firewall manager and press Enter. This applies even in cases where
       only one option is listed.

    6. Choose to use either a local or remote PostgreSQL database as the Data
       Warehouse database:

 Where is the DWH database located? (Local, Remote) [Local]:

          o If you select Local, the engine-setup command can configure your
            database automatically (including adding a user and a database),
            or it can connect to a preconfigured local database:

 Setup can configure the local postgresql server automatically for the DWH to run. This may conflict with existing applications.
 Would you like Setup to automatically configure postgresql and create DWH database, or prefer to perform that manually? (Automatic, Manual) [Automatic]:

               o If you select Automatic by pressing Enter, no further action
                 is required here.
               o If you select Manual, input the following values for the
                 manually-configured local database:

 DWH database secured connection (Yes, No) [No]:
 DWH database name [ovirt_engine_history]:
 DWH database user [ovirt_engine_history]:
 DWH database password:

            Note

            engine-setup requests these values after the Manager database is
            configured in the next step.

          o If you select Remote, input the following values for the
            preconfigured remote database host:

 DWH database host [localhost]:
 DWH database port [5432]:
 DWH database secured connection (Yes, No) [No]:
 DWH database name [ovirt_engine_history]:
 DWH database user [ovirt_engine_history]:
 DWH database password:

       Note

       engine-setup requests these values after the Manager database is
       configured in the next step.

    7. Choose to use either a local or remote PostgreSQL database as the
       Manager database:

 Where is the Engine database located? (Local, Remote) [Local]:

          o If you select Local, the engine-setup command can configure your
            database automatically (including adding a user and a database),
            or it can connect to a preconfigured local database:

 Setup can configure the local postgresql server automatically for the engine to run. This may conflict with existing applications.
 Would you like Setup to automatically configure postgresql and create Engine database, or prefer to perform that manually? (Automatic, Manual) [Automatic]:

               o If you select Automatic by pressing Enter, no further action
                 is required here.
               o If you select Manual, input the following values for the
                 manually-configured local database:

 Engine database secured connection (Yes, No) [No]:
 Engine database name [engine]:
 Engine database user [engine]:
 Engine database password:

          o If you select Remote, input the following values for the
            preconfigured remote database host:

 Engine database host [localhost]:
 Engine database port [5432]:
 Engine database secured connection (Yes, No) [No]:
 Engine database name [engine]:
 Engine database user [engine]:
 Engine database password:

    8. Set a password for the automatically created administrative user of
       the Red Hat Virtualization Manager:

 Engine admin password:
 Confirm engine admin password:

    9. Select Gluster, Virt, or Both:

 Application mode (Both, Virt, Gluster) [Both]:

       Both offers the greatest flexibility. In most cases, select Both. Virt
       application mode allows you to run virtual machines in the
       environment; Gluster application mode only allows you to manage
       GlusterFS from the Administration Portal.

   10. If you installed the OVN provider, you can choose to use the default
       credentials, or specify an alternative.

 Use default credentials (admin@internal) for ovirt-provider-ovn (Yes, No) [Yes]:
 oVirt OVN provider user[admin@internal]:
 oVirt OVN provider password:

   11. Set the default value for the wipe_after_delete flag, which wipes the
       blocks of a virtual disk when the disk is deleted.

 Default SAN wipe after delete (Yes, No) [No]:

   12. The Manager uses certificates to communicate securely with its hosts.
       This certificate can also optionally be used to secure HTTPS
       communications with the Manager. Provide the organization name for the
       certificate:

 Organization name for certificate [autodetected domain-based name]:

   13. Optionally allow engine-setup to make the landing page of the Manager
       the default page presented by the Apache web server:

 Setup can configure the default page of the web server to present the application home page. This may conflict with existing applications.
 Do you wish to set the application as the default web page of the server? (Yes, No) [Yes]:

   14. By default, external SSL (HTTPS) communication with the Manager is
       secured with the self-signed certificate created earlier in the
       configuration to securely communicate with hosts. Alternatively,
       choose another certificate for external HTTPS connections; this does
       not affect how the Manager communicates with hosts:

 Setup can configure apache to use SSL using a certificate issued from the internal CA.
 Do you wish Setup to configure that, or prefer to perform that manually? (Automatic, Manual) [Automatic]:

   15. Choose how long Data Warehouse will retain collected data:

       Note

       This step is skipped if you chose not to configure Data Warehouse on
       the Manager machine.

 Please choose Data Warehouse sampling scale:
 (1) Basic
 (2) Full
 (1, 2)[1]:

       Full uses the default values for the data storage settings listed in
       the Data Warehouse Guide (recommended when Data Warehouse is installed
       on a remote host).

       Basic reduces the values of DWH_TABLES_KEEP_HOURLY to 720 and
       DWH_TABLES_KEEP_DAILY to 0, easing the load on the Manager machine
       (recommended when the Manager and Data Warehouse are installed on the
       same machine).

   16. Review the installation settings, and press Enter to accept the values
       and proceed with the installation:

 Please confirm installation settings (OK, Cancel) [OK]:

       When your environment has been configured, engine-setup displays
       details about how to access your environment. If you chose to manually
       configure the firewall, engine-setup provides a custom list of ports
       that need to be opened, based on the options selected during setup.
       The engine-setup command also saves your answers to a file that can be
       used to reconfigure the Manager using the same values, and outputs the
       location of the log file for the Red Hat Virtualization Manager
       configuration process.

   17. If you intend to link your Red Hat Virtualization environment with a
       directory server, configure the date and time to synchronize with the
       system clock used by the directory server to avoid unexpected account
       expiry issues. See Synchronizing the System Clock with a Remote Server
       in the Red Hat Enterprise Linux System Administrator’s Guide for more
       information.
   18. Install the certificate authority according to the instructions
       provided by your browser. You can get the certificate authority’s
       certificate by navigating
       to`http://your-manager-fqdn/ovirt-engine/services/pki-resource?resource=ca-certificate&format=X509-PEM-CA`,
       replacing your-manager-fqdn with the fully qualified domain name
       (FQDN) that you provided during the installation.

   Proceed to the next section to connect to the Administration Portal as the
   admin@internal user. Then, proceed with setting up hosts, and attaching
   storage.

  2.2.1. Configuring the Red Hat Virtualization Manager

  2.2.2. Connecting to the Administration Portal

2.3. Installing Hosts

2.4. Attaching Storage

2.5. Installing Red Hat CloudForms

                              Chapter 3. Discovery

   Add VMware to CF as provider:

   https://access.redhat.com/documentation/en-us/red_hat_cloudforms/4.6/html-single/managing_providers/#vmware_vcenter_providers

   Discover infrastructure:

   https://access.redhat.com/documentation/en-us/red_hat_cloudforms/4.6/html-single/managing_providers/#discovering_multiple_management_systems

   Discovering the source environment with Cloud Forms (What am I migrating?)

   Scaling - minimum and max size migrations? At least a note about max size

   Planning the target environment (What will I need to hold it?)

   Identifying resource gaps (What am I missing? Ex: bandwidth, storage,
   licenses, maintenance window) - a reminder

   Estimating the time requirements (How long will it take? How long do I
   have?)

   Determining the impact on others (Will this disrupt the production
   environment? Will users lack access to critical applications?)

                              Chapter 4. Planning

   Mapping resources with CF

   Calculating downtime

   Determining VMs to be migrated and their placement (groups)

   Creating Migration Plan

   Using a discovery report to create a target RHV infrastructure

   Identifying workloads to move

     o What workloads need to migrate together?
     o What applications must remain available?

   Creating migration groups

     o Best practices:

          o Keep linked applications together and migrate at the same time
          o Move critical applications during maintenance windows
          o Plan for redundancy
          o Stagger migration schedules

   Creating a schedule

     o Preparing users for downtime
     o Minimizing impact on your environment

          o Throttling
          o Scheduling

   Creating playbooks for pre-migration tasks

   Migrating

   Creating playbooks for post-migration tasks

   Checking logs

                              Chapter 5. Migration

   UI part from CF documentation

   Starting a migration plan

   Monitoring the migration

   Estimating how long migration will take

   Estimating the remaining migration time

   Viewing running migrations

                           Chapter 6. Post-migration

   Miscellaneous tasks after you’ve completed migration. Tying up loose ends,
   fixing stuff that didn’t work.

   Checking for incomplete migrations (UI or log?)

   Checking and reporting status of completed migrations

   Finding migrated workloads

   Viewing your migration history

   Recovering failed migrations

   Restoring to original state

   Retrying failed migrations

   Reversing successful migrations
