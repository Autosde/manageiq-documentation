<?xml version='1.0' encoding='UTF-8'?>
<!DOCTYPE book [
<!ENTITY % sgml.features "IGNORE">
<!ENTITY % xml.features "INCLUDE">
<!ENTITY % DOCBOOK_ENTS PUBLIC "-//OASIS//ENTITIES DocBook Character Entities V4.5//EN" "http://www.oasis-open.org/docbook/xml/4.5/dbcentx.mod">
%DOCBOOK_ENTS;
]>
<?asciidoc-toc maxdepth="3"?><book xmlns="http://docbook.org/ns/docbook" xmlns:xlink="http://www.w3.org/1999/xlink" version="5.0">
<info>
<title>Infrastructure Migration Solution Guide</title><subtitle>Migrating from VMware to Red Hat Virtualization or Red Hat OpenStack Platform</subtitle>

<date>2019-04-23</date>
<productname>Red Hat Infrastructure Migration Solution</productname>
<productnumber>1.1</productnumber>
<abstract>
    <para>This guide describes how to plan, perform, and troubleshoot an infrastructure migration from VMware to Red Hat Virtualization or Red Hat OpenStack Platform. The migration is performed with Red Hat CloudForms.</para>
</abstract>
<xi:include xmlns:xi="http://www.w3.org/2001/XInclude" href="Author_Group.xml"/>
</info>
<chapter xml:id="IMS_overview">
<title>Infrastructure Migration Solution overview</title>
<simpara>The Red Hat Infrastructure Migration Solution (IMS) enables you to migrate virtual machines from VMware 5.5 (and later) to the following target environments:</simpara>
<itemizedlist>
<listitem>
<simpara>Red Hat Virtualization 4.2</simpara>
<simpara>Red Hat Virtualization (RHV) is a virtualization platform built on Red Hat Enterprise Linux. You can manage your virtual infrastructure, including hosts, virtual machines, networks, storage, and users, from a centralized graphical user interface or with a REST API (for more information, see the <link xlink:href="https://access.redhat.com/documentation/en-us/red_hat_virtualization/4.2/">Red Hat Virtualization documentation</link>).</simpara>
</listitem>
<listitem>
<simpara>Red Hat OpenStack Platform 13 or 14</simpara>
<simpara>Red Hat OpenStack Platform enables you to create a scaleable, fault-tolerant, private or public cloud based on Red Hat Enterprise Linux (for more information, see the <link xlink:href="https://access.redhat.com/documentation/en-us/red_hat_openstack_platform/14/">Red Hat OpenStack Platform documentation</link>).</simpara>
</listitem>
</itemizedlist>
<simpara>The migration process is performed with CloudForms 4.7, a user interface for managing the infrastructure (for more information, see the <link xlink:href="https://access.redhat.com/documentation/en-us/red_hat_cloudforms/4.7/">Red Hat CloudForms documentation</link>).</simpara>
<simpara>The migration process has the following key steps:</simpara>
<orderedlist numeration="arabic">
<listitem>
<simpara><link linkend="Planning_the_migration">Planning the migration</link>:</simpara>
<itemizedlist>
<listitem>
<simpara><link linkend="Questions_to_ask_before_migration">Questions to ask before migration</link> to estimate time and resource requirements, including the following:</simpara>
<itemizedlist>
<listitem>
<simpara><link linkend="How_long_will_the_migration_take">"How long will the migration take?"</link></simpara>
<itemizedlist>
<listitem>
<simpara><xref linkend="Rhv_migration_example"/></simpara>
</listitem>
<listitem>
<simpara><xref linkend="osp_migration_example"/></simpara>
</listitem>
</itemizedlist>
</listitem>
<listitem>
<simpara><link linkend="Deciding_how_many_conversion_hosts_to_create">"How many conversion hosts do I need?"</link></simpara>
</listitem>
<listitem>
<simpara><link linkend="Choosing_vddk_or_ssh_transformation">"Which datapath transformation option, VDDK or SSH?"</link></simpara>
</listitem>
</itemizedlist>
</listitem>
<listitem>
<simpara><link linkend="Recommendations_for_migration">Recommendations to minimize the impact on your users</link></simpara>
</listitem>
</itemizedlist>
</listitem>
<listitem>
<simpara><link linkend="Preparing_the_environment_for_migration">Preparing the environment for migration</link>:</simpara>
<itemizedlist>
<listitem>
<simpara><link linkend="Preparing_the_vmware_source_environment">Preparing the source environment</link></simpara>
</listitem>
<listitem>
<simpara><link linkend="Preparing_the_target_environment">Preparing the target environment</link> (configuring storage and networks, as well as installing and configuring software packages)</simpara>
</listitem>
<listitem>
<simpara><link linkend="Configuring_the_conversion_hosts">Configuring the conversion hosts</link> (Conversion hosts are RHV hosts or OpenStack Platform instances running <literal>virt-v2v</literal> and <literal>virt-v2v-wrapper</literal>, which perform the migration.)</simpara>
</listitem>
</itemizedlist>
</listitem>
<listitem>
<simpara><link linkend="Migrating_the_infrastructure">Migrating the infrastructure in CloudForms</link>:</simpara>
<itemizedlist>
<listitem>
<simpara><link linkend="Creating_an_infrastructure_mapping">Mapping the source and target infrastructures</link></simpara>
</listitem>
<listitem>
<simpara><link linkend="Creating_and_running_a_migration_plan">Creating and running a migration plan</link>. For details, see the migration workflows:</simpara>
<itemizedlist>
<listitem>
<simpara><xref linkend="Vmware_to_rhv_migration_workflow"/></simpara>
</listitem>
<listitem>
<simpara><xref linkend="Vmware_to_osp_migration_workflow"/></simpara>
</listitem>
</itemizedlist>
</listitem>
</itemizedlist>
</listitem>
</orderedlist>
<section xml:id="Vmware_to_rhv_migration_workflow">
<title>Red Hat Virtualization migration workflow</title>
<simpara>This diagram describes the workflow of a migration to Red Hat Virtualization.</simpara>
<figure>
<title>VMware to Red Hat Virtualization migration workflow</title>
<mediaobject>
<imageobject>
<imagedata fileref="images/vmware_to_rhv_migration_workflow.png"/>
</imageobject>
<textobject><phrase>vmware to rhv migration workflow</phrase></textobject>
</mediaobject>
</figure>
<simpara><inlinemediaobject>
<imageobject>
<imagedata fileref="images/circle_step_numbers/1.png" contentwidth="25"/>
</imageobject>
<textobject><phrase>25</phrase></textobject>
</inlinemediaobject> You create and run a migration plan in CloudForms.</simpara>
<simpara><inlinemediaobject>
<imageobject>
<imagedata fileref="images/circle_step_numbers/2.png" contentwidth="25"/>
</imageobject>
<textobject><phrase>25</phrase></textobject>
</inlinemediaobject> CloudForms uses the migration plan to locate the source virtual machines.</simpara>
<simpara><inlinemediaobject>
<imageobject>
<imagedata fileref="images/circle_step_numbers/3.png" contentwidth="25"/>
</imageobject>
<textobject><phrase>25</phrase></textobject>
</inlinemediaobject> If you are using <link linkend="Choosing_vddk_or_ssh_transformation">VDDK transformation</link>, CloudForms captures the ESXi host fingerprint for authentication during the virtual machine conversion process.</simpara>
<simpara><inlinemediaobject>
<imageobject>
<imagedata fileref="images/circle_step_numbers/4.png" contentwidth="25"/>
</imageobject>
<textobject><phrase>25</phrase></textobject>
</inlinemediaobject> Using the attributes defined for the Red Hat Virtualization environment, CloudForms initiates communication with the conversion hosts (RHV host with <literal>virt-v2v</literal> and <literal>virt-v2v-wrapper</literal> installed)</simpara>
<simpara><inlinemediaobject>
<imageobject>
<imagedata fileref="images/circle_step_numbers/5.png" contentwidth="25"/>
</imageobject>
<textobject><phrase>25</phrase></textobject>
</inlinemediaobject> <literal>virt-v2v-wrapper</literal> connects to the source datastore through the ESXi host. <literal>virt-v2v</literal> streams the source disks to the target data domain and converts the source disks.</simpara>
<simpara><inlinemediaobject>
<imageobject>
<imagedata fileref="images/circle_step_numbers/6.png" contentwidth="25"/>
</imageobject>
<textobject><phrase>25</phrase></textobject>
</inlinemediaobject> <literal>virt-v2v-wrapper</literal> creates a target RHV virtual machine, using the source virtual machine’s metadata in order to maintain its attributes (tags, power state, MAC address, CPU count, memory, disks, and virtual machine name) after migration.</simpara>
<simpara><inlinemediaobject>
<imageobject>
<imagedata fileref="images/circle_step_numbers/7.png" contentwidth="25"/>
</imageobject>
<textobject><phrase>25</phrase></textobject>
</inlinemediaobject> <literal>virt-v2v</literal> attaches the converted disks to the RHV virtual machine. (The RHV virtual machine’s power state is identical to the source virtual machine’s premigration state.)</simpara>
<simpara>The migration process is complete and the migration plan’s status is displayed in CloudForms.</simpara>
</section>
<section xml:id="Vmware_to_osp_migration_workflow">
<title>Red Hat OpenStack Platform migration workflow</title>
<simpara>This diagram describes the workflow of a migration to OpenStack Platform.</simpara>
<figure>
<title>VMware to OpenStack Platform migration workflow</title>
<mediaobject>
<imageobject>
<imagedata fileref="images/vmware_to_osp_migration_workflow.png"/>
</imageobject>
<textobject><phrase>vmware to osp migration workflow</phrase></textobject>
</mediaobject>
</figure>
<simpara><inlinemediaobject>
<imageobject>
<imagedata fileref="images/circle_step_numbers/1.png" contentwidth="25"/>
</imageobject>
<textobject><phrase>25</phrase></textobject>
</inlinemediaobject> You create and run a migration plan in CloudForms.</simpara>
<simpara><inlinemediaobject>
<imageobject>
<imagedata fileref="images/circle_step_numbers/2.png" contentwidth="25"/>
</imageobject>
<textobject><phrase>25</phrase></textobject>
</inlinemediaobject> CloudForms uses the migration plan to locate the source virtual machines.</simpara>
<simpara><inlinemediaobject>
<imageobject>
<imagedata fileref="images/circle_step_numbers/3.png" contentwidth="25"/>
</imageobject>
<textobject><phrase>25</phrase></textobject>
</inlinemediaobject> If you are using <link linkend="Choosing_vddk_or_ssh_transformation">VDDK transformation</link>, CloudForms captures the ESXi host fingerprint for authentication during the virtual machine conversion process.</simpara>
<simpara><inlinemediaobject>
<imageobject>
<imagedata fileref="images/circle_step_numbers/4.png" contentwidth="25"/>
</imageobject>
<textobject><phrase>25</phrase></textobject>
</inlinemediaobject> Using the attributes defined for the OpenStack Platform environment, CloudForms initiates communication with the conversion hosts (OpenStack Platform instance created from a conversion host appliance, with <literal>virt-v2v</literal> and <literal>virt-v2v-wrapper</literal> installed)</simpara>
<simpara><inlinemediaobject>
<imageobject>
<imagedata fileref="images/circle_step_numbers/5.png" contentwidth="25"/>
</imageobject>
<textobject><phrase>25</phrase></textobject>
</inlinemediaobject> <literal>virt-v2v-wrapper</literal> connects to the source datastore through the ESXi host. <literal>virt-v2v</literal> streams the source disks to the target data domain and converts the source disks.</simpara>
<simpara><inlinemediaobject>
<imageobject>
<imagedata fileref="images/circle_step_numbers/6.png" contentwidth="25"/>
</imageobject>
<textobject><phrase>25</phrase></textobject>
</inlinemediaobject> After the source disks are converted, <literal>virt-v2v</literal> detaches the volumes from the conversion host, migrates the volumes to the destination project, and creates the network ports defined in the infrastructure mapping.</simpara>
<simpara><inlinemediaobject>
<imageobject>
<imagedata fileref="images/circle_step_numbers/7.png" contentwidth="25"/>
</imageobject>
<textobject><phrase>25</phrase></textobject>
</inlinemediaobject> <literal>virt-v2v-wrapper</literal> creates the target OpenStack Platform instance with the flavor and security group defined in the migration plan. <literal>virt-v2v</literal> attaches the newly created network ports and the disks mapped in the block storage to the instance and the instance is powered on.</simpara>
<simpara>The migration process is complete and the migration plan’s status is displayed in CloudForms.</simpara>
</section>
</chapter>
<chapter xml:id="Planning_the_migration">
<title>Planning the migration</title>
<simpara>During the planning phase, you will formulate a specific migration goal, for example, "I want to migrate 2000 virtual machines, with 200 TB of data, in less than 6 months".</simpara>
<simpara>The following information can help you plan your migration:</simpara>
<itemizedlist>
<listitem>
<simpara><link linkend="Questions_to_ask_before_migration">Questions to ask before migration</link>:</simpara>
<itemizedlist>
<listitem>
<simpara><link linkend="How_long_will_the_migration_take">"How long will the migration take?"</link></simpara>
<itemizedlist>
<listitem>
<simpara><xref linkend="Rhv_migration_example"/></simpara>
</listitem>
<listitem>
<simpara><xref linkend="osp_migration_example"/></simpara>
</listitem>
</itemizedlist>
</listitem>
<listitem>
<simpara><link linkend="Deciding_how_many_conversion_hosts_to_create">"How many conversion hosts do I need?"</link></simpara>
</listitem>
<listitem>
<simpara><link linkend="Choosing_vddk_or_ssh_transformation">"Which datapath transformation option, VDDK or SSH?"</link></simpara>
</listitem>
</itemizedlist>
</listitem>
<listitem>
<simpara><xref linkend="Recommendations_for_migration"/>:</simpara>
<itemizedlist>
<listitem>
<simpara><xref linkend="Distributing_the_migration_workload"/></simpara>
</listitem>
<listitem>
<simpara><xref linkend="Controlling_the_migration_process"/></simpara>
</listitem>
</itemizedlist>
</listitem>
</itemizedlist>
<section xml:id="Questions_to_ask_before_migration">
<title>Questions to ask before migration</title>
<simpara>The following questions can help you to estimate the resources and time required for migration:</simpara>
<variablelist>
<varlistentry>
<term>What am I migrating?</term>
<listitem>
<itemizedlist>
<listitem>
<simpara>Identify the virtual machines to be migrated.</simpara>
</listitem>
</itemizedlist>
</listitem>
</varlistentry>
<varlistentry>
<term>What is the maximum number of disks, virtual machines, or NICs that I can migrate?</term>
<listitem>
<itemizedlist>
<listitem>
<simpara>There is no maximum number of disks or virtual machines that you can migrate. However, you may not want to migrate all your virtual machines at the same time, in order to minimize the impact on your users.</simpara>
<important>
<simpara>If you exceed the capabilities of your environment, the migrations will fail. This situation could affect existing applications running on virtual machines attached to the network and storage.</simpara>
</important>
</listitem>
</itemizedlist>
</listitem>
</varlistentry>
<varlistentry>
<term>What operating systems can I migrate?</term>
<listitem>
<itemizedlist>
<listitem>
<simpara>For a list of supported guest operating systems, see <link xlink:href="https://access.redhat.com/articles/1351473">https://access.redhat.com/articles/1351473</link>.</simpara>
</listitem>
<listitem>
<simpara>For a list of certified guest operating systems, see <link xlink:href="https://access.redhat.com/articles/973163">https://access.redhat.com/articles/973163</link>.</simpara>
<simpara>Although it is possible to migrate guest operating systems that are not certified for Red Hat Virtualization or OpenStack Platform, these guests are not officially supported.</simpara>
</listitem>
</itemizedlist>
</listitem>
</varlistentry>
<varlistentry>
<term>What resources does my target environment require?</term>
<listitem>
<itemizedlist>
<listitem>
<simpara>Your target environment must be large enough to run the migrated virtual machines in addition to the source virtual machines. The source virtual machines are not affected by the migration process.</simpara>
</listitem>
</itemizedlist>
</listitem>
</varlistentry>
<varlistentry>
<term>What am I missing?</term>
<listitem>
<itemizedlist>
<listitem>
<simpara>Identify resource gaps, such as bandwidth, storage, licenses, or a suitable maintenance window.</simpara>
</listitem>
</itemizedlist>
</listitem>
</varlistentry>
<varlistentry>
<term>What impact will the migration have on my users?</term>
<listitem>
<itemizedlist>
<listitem>
<simpara>Assess the effects the migration may have on a production environment.</simpara>
<simpara>It may be possible to migrate your applications in phases, without downtime at the application layer, if the applications are distributed in a high-availability architecture.</simpara>
</listitem>
<listitem>
<simpara>Check whether users will lose access to critical applications.</simpara>
</listitem>
</itemizedlist>
</listitem>
</varlistentry>
</variablelist>
<section xml:id="How_long_will_the_migration_take">
<title>How long will the migration take?</title>
<simpara>There are no specific rules to determine how long the actual migration will take. This is determined on a case-by-case basis.</simpara>
<simpara>The following migration examples are provided as a guide.</simpara>
<example xml:id="Rhv_migration_example">
<title>Red Hat Virtualization migration</title>
<itemizedlist>
<listitem>
<simpara>Duration of migration: 1:15:53 (<emphasis>hh:mm:ss</emphasis>)</simpara>
</listitem>
<listitem>
<simpara>10 virtual machines</simpara>
</listitem>
<listitem>
<simpara>Total data migrated, using VDDK: 1000 GB</simpara>
</listitem>
<listitem>
<simpara>Hardware:</simpara>
<itemizedlist>
<listitem>
<simpara>Strong host (40 cores, 500 GB RAM)</simpara>
</listitem>
<listitem>
<simpara>Fast SSD XtremIO storage</simpara>
</listitem>
<listitem>
<simpara>Fibre Channel 8 interface for host-to-storage connection</simpara>
</listitem>
<listitem>
<simpara>10 GbE network interface cards for all other connections</simpara>
</listitem>
</itemizedlist>
</listitem>
</itemizedlist>
</example>
<example xml:id="osp_migration_example">
<title>OpenStack Platform migration</title>
<itemizedlist>
<listitem>
<simpara>Duration of migration: 2:13:00 (<emphasis>hh:mm:ss</emphasis>)</simpara>
</listitem>
<listitem>
<simpara>20 virtual machines</simpara>
</listitem>
<listitem>
<simpara>2 conversion hosts, maximum of 10 concurrent conversions</simpara>
</listitem>
<listitem>
<simpara>Total data migrated, using VDDK: 1000 GB</simpara>
</listitem>
<listitem>
<simpara>Hardware: See <xref linkend="Rhv_migration_example"/></simpara>
</listitem>
</itemizedlist>
</example>
</section>
<section xml:id="Deciding_how_many_conversion_hosts_to_create">
<title>How many conversion hosts do I need?</title>
<simpara>The number of conversion hosts you create depends on the size of your migration. All the virtual machines in the migration plan are migrated at the same time, in parallel. The number of virtual machines that you can migrate simultaneously depends on your infrastructure capabilities. Each migration requires a certain amount of network bandwidth, I/O throughput, and processing power for the conversion process.</simpara>
<simpara>Multiple conversion hosts provide load-balancing and better performance, even for small migrations.</simpara>
<simpara>Conversion hosts and providers are limited to ten concurrent migrations, unless you change the default maximum number of concurrent migrations (see <xref linkend="Changing_the_maximum_number_of_concurrent_migrations"/>).</simpara>
<simpara>Test your environment thoroughly before the migration to determine how many migrations it can support without negative effects, for example, five conversion hosts, each running ten concurrent migrations.</simpara>
</section>
<section xml:id="Choosing_vddk_or_ssh_transformation">
<title>Which transformation method, VDDK or SSH?</title>
<simpara>You will configure the conversion hosts to use either the VMware Virtual Disk Development Kit (VDDK) or SSH as the transformation method for converting the virtual machines. The choice is determined by the number of virtual machines you are migrating and the capabilities of your infrastructure.</simpara>
<simpara>The following table compares the options.</simpara>
<table frame="all" rowsep="1" colsep="1">
<title>VDDK and SSH comparison</title>
<tgroup cols="3">
<colspec colname="col_1" colwidth="20*"/>
<colspec colname="col_2" colwidth="40*"/>
<colspec colname="col_3" colwidth="40*"/>
<thead>
<row>
<entry align="left" valign="top"/>
<entry align="center" valign="top">Pros</entry>
<entry align="center" valign="top">Cons</entry>
</row>
</thead>
<tbody>
<row>
<entry align="left" valign="top"><simpara><emphasis role="strong">VDDK</emphasis></simpara></entry>
<entry align="left" valign="top"><itemizedlist>
<listitem>
<simpara>Recommended because it is approximately twice as fast as SSH</simpara>
</listitem>
<listitem>
<simpara>Compiled with <literal>nbdkit</literal>, which provides direct connectivity to the virtual machine disks</simpara>
</listitem>
</itemizedlist></entry>
<entry align="left" valign="top"><itemizedlist>
<listitem>
<simpara>Requires VDDK package download</simpara>
</listitem>
<listitem>
<simpara>Requires VDDK library location for configuring the conversion hosts</simpara>
</listitem>
<listitem>
<simpara>Limited to 20 concurrent migrations per conversion host. (This is due to ESXi memory limitation. See <link xlink:href="http://libguestfs.org/virt-v2v.1.html#vddk:-esxi-nfc-service-memory-limits">http://libguestfs.org/virt-v2v.1.html#vddk:-esxi-nfc-service-memory-limits</link> for details.)</simpara>
</listitem>
</itemizedlist></entry>
</row>
<row>
<entry align="left" valign="top"><simpara><emphasis role="strong">SSH</emphasis></simpara></entry>
<entry align="left" valign="top"><itemizedlist>
<listitem>
<simpara>Better suited for large-scale migrations than VDDK (not affected by ESXi memory limitation)</simpara>
</listitem>
<listitem>
<simpara>Does not require additional downloads, packages, tools, or compilation</simpara>
</listitem>
</itemizedlist></entry>
<entry align="left" valign="top"><itemizedlist>
<listitem>
<simpara>Slower than VDDK</simpara>
</listitem>
<listitem>
<simpara>Requires the VMware hypervisors to have SSH access enabled</simpara>
</listitem>
<listitem>
<simpara>Requires shared SSH keys for the source and target environments</simpara>
</listitem>
</itemizedlist></entry>
</row>
</tbody>
</tgroup>
</table>
</section>
</section>
<section xml:id="Recommendations_for_migration">
<title>Recommendations for migration</title>
<simpara>The following recommendations will minimize the impact of the migration on your environment.</simpara>
<itemizedlist>
<title>Scheduling the migration</title>
<listitem>
<simpara>Schedule your migration carefully, to minimize the impact on your users.</simpara>
</listitem>
<listitem>
<simpara>Prepare your users for downtime.</simpara>
<important>
<simpara>Currently, IMS supports only cold migration. Virtual machines are powered off gracefully as part of the migration process.</simpara>
</important>
</listitem>
<listitem>
<simpara>Stagger the migration schedules.</simpara>
</listitem>
<listitem>
<simpara>Move critical applications during maintenance windows.</simpara>
</listitem>
</itemizedlist>
<itemizedlist xml:id="Distributing_the_migration_workload">
<title>Distributing the migration workload</title>
<listitem>
<simpara>Create migration groups, so that you are not migrating all of your virtual machines at the same time, keeping in mind the following considerations:</simpara>
<itemizedlist>
<listitem>
<simpara>How are the virtual machines grouped now?</simpara>
</listitem>
<listitem>
<simpara>Which virtual machines should be migrated together?</simpara>
</listitem>
<listitem>
<simpara>Which workloads or linked applications should be migrated together?</simpara>
</listitem>
<listitem>
<simpara>What applications must remain available?</simpara>
</listitem>
</itemizedlist>
</listitem>
<listitem>
<simpara>Consider which parts of the workload to migrate first:</simpara>
<itemizedlist>
<listitem>
<simpara>Databases</simpara>
</listitem>
<listitem>
<simpara>Applications</simpara>
</listitem>
<listitem>
<simpara>Web servers</simpara>
</listitem>
<listitem>
<simpara>Load balancers</simpara>
</listitem>
</itemizedlist>
</listitem>
</itemizedlist>
<itemizedlist xml:id="Deploying_conversion_hosts">
<title>Deploying conversion hosts</title>
<listitem>
<simpara>Create an appropriate number of conversion hosts. See <xref linkend="Deciding_how_many_conversion_hosts_to_create"/></simpara>
</listitem>
<listitem>
<simpara>Choose the best datapath transformation option for your environment. See <xref linkend="Choosing_vddk_or_ssh_transformation"/></simpara>
</listitem>
<listitem>
<simpara>OpenStack Platform:</simpara>
<itemizedlist>
<listitem>
<simpara>Deploy conversion hosts on multiple compute nodes.</simpara>
</listitem>
<listitem>
<simpara>Deploy conversion hosts on a compute node with nested virtualization enabled (see <link xlink:href="https://docs.openstack.org/devstack/latest/guides/devstack-with-nested-kvm.html">https://docs.openstack.org/devstack/latest/guides/devstack-with-nested-kvm.html</link>). Nested virtualization is a technology preview.</simpara>
</listitem>
</itemizedlist>
</listitem>
</itemizedlist>
<itemizedlist xml:id="Controlling_the_migration_process">
<title>Controlling the migration process</title>
<listitem>
<simpara>Create multiple <link linkend="Creating_and_running_a_migration_plan">migration plans</link> for finer control.</simpara>
</listitem>
<listitem>
<simpara>Perform test migrations with different maximum numbers of concurrent migrations to assess the capabilities of your environment’s infrastructure (see <xref linkend="Changing_the_maximum_number_of_concurrent_migrations"/>).</simpara>
</listitem>
</itemizedlist>
</section>
</chapter>
<chapter xml:id="Preparing_the_environment_for_migration">
<title>Preparing the environment for migration</title>
<simpara>Preparing the environment for migration involves the following key steps:</simpara>
<orderedlist numeration="arabic">
<listitem>
<simpara><link linkend="Preparing_the_vmware_source_environment">Preparing the source environment:</link></simpara>
<itemizedlist>
<listitem>
<simpara><xref linkend="Preparing_the_source_virtual_machines"/></simpara>
</listitem>
<listitem>
<simpara><xref linkend="Configuring_the_vmware_hypervisors_for_ssh_transformation"/></simpara>
</listitem>
</itemizedlist>
</listitem>
<listitem>
<simpara><link linkend="Preparing_the_target_environment">Preparing the target environment</link>:</simpara>
<itemizedlist>
<listitem>
<simpara><xref linkend="Preparing_the_rhv_target_environment"/></simpara>
</listitem>
<listitem>
<simpara><xref linkend="Preparing_the_osp_target_environment"/></simpara>
<itemizedlist>
<listitem>
<simpara><xref linkend="Deploying_osp_conversion_hosts"/></simpara>
</listitem>
</itemizedlist>
</listitem>
</itemizedlist>
</listitem>
<listitem>
<simpara><link linkend="Configuring_the_conversion_hosts">Configuring the conversion hosts</link></simpara>
</listitem>
</orderedlist>
<simpara>Optionally, you can <link linkend="Changing_the_maximum_number_of_concurrent_migrations">change the maximum number of concurrent migrations</link> of conversion hosts or providers, for better performance and control of the migration process.</simpara>
<section xml:id="Preparing_the_vmware_source_environment">
<title>Preparing the source environment</title>
<simpara>To prepare the source environment:</simpara>
<orderedlist numeration="arabic">
<listitem>
<simpara>Extend the VMware network to the target environment.</simpara>
<important>
<itemizedlist>
<listitem>
<simpara>The network configuration must not be changed in any way during the migration.</simpara>
</listitem>
<listitem>
<simpara>IP addresses, VLANs, and other network configurations should not be changed before or after migration because the conversion process preserves the source virtual machine MAC addresses.</simpara>
</listitem>
</itemizedlist>
</important>
</listitem>
<listitem>
<simpara><link linkend="Preparing_the_source_virtual_machines">Prepare the source virtual machines</link>.</simpara>
</listitem>
<listitem>
<simpara>If you are using SSH transformation, <link linkend="Configuring_the_vmware_hypervisors_for_ssh_transformation">configure the VMware hypervisors</link>.</simpara>
</listitem>
</orderedlist>
<formalpara xml:id="Preparing_the_source_virtual_machines">
<title>Preparing the source virtual machines</title>
<para>Prepare each source virtual machine for migration:</para>
</formalpara>
<itemizedlist>
<listitem>
<simpara>Install VMware Tools to capture IP addresses. For download and installation instructions, navigate to <link xlink:href="https://www.vmware.com/support/ws5/doc/new_guest_tools_ws.html">https://www.vmware.com/support/ws5/doc/new_guest_tools_ws.html</link>.</simpara>
</listitem>
<listitem>
<simpara>Unmount mounted ISO/CDROM disks.</simpara>
</listitem>
<listitem>
<simpara>Ensure that attached disks are not encrypted.</simpara>
</listitem>
<listitem>
<simpara>Ensure that each NIC has no more than one IPv4 and/or one IPv6 address.</simpara>
</listitem>
<listitem>
<simpara>Ensure that the virtual machine names contain only upper- or lower-case letters, numbers, underscores (<literal>_</literal>), hyphens (<literal>-</literal>), or periods (<literal>.</literal>).</simpara>
<note>
<simpara>International characters and spaces are not permitted.</simpara>
</note>
</listitem>
<listitem>
<simpara>Ensure that source virtual machine names do not duplicate target machine names for the appropriate scope:</simpara>
<itemizedlist>
<listitem>
<simpara>Red Hat Virtualization: Within the entire environment</simpara>
</listitem>
<listitem>
<simpara>OpenStack Platform: Within a single tenant</simpara>
</listitem>
</itemizedlist>
</listitem>
</itemizedlist>
<formalpara xml:id="Configuring_the_vmware_hypervisors_for_ssh_transformation">
<title>Configuring the VMware hypervisors for SSH transformation</title>
<para>SSH transformation requires passwordless access to the VMware hypervisors. Passwordless access involves enabling SSH access on the VMware hypervisors, generating an SSH key pair, and copying the public key to the VMware hypervisors. You will use the private key of the SSH key pair in <xref linkend="Configuring_the_conversion_hosts"/>.</para>
</formalpara>
<simpara>Using a single SSH key pair for all conversion hosts is recommended because the key pair is used only for virtual machine conversion and simplifies conversion host management. If you wish to use a dedicated SSH key pair for each conversion host, you can create multiple key pairs and copy all the public keys to all the VMware hypervisors.</simpara>
<simpara>Configure the VMware hypervisors:</simpara>
<orderedlist numeration="arabic">
<listitem>
<simpara>Enable SSH access on each VMware hypervisor. For instructions, navigate to <link xlink:href="https://docs.vmware.com/en/VMware-vSphere/index.html">https://docs.vmware.com/en/VMware-vSphere/index.html</link>. In the navigation pane, click <menuchoice><guimenu>vSphere <emphasis>version</emphasis></guimenu> <guisubmenu>ESXi and vCenter Server</guisubmenu> <guisubmenu>VMware ESXi Installation and Setup</guisubmenu> <guisubmenu>Installing and Setting Up ESXi</guisubmenu> <guisubmenu>Setting Up ESXi</guisubmenu> <guimenuitem>Enable ESXi Shell and SSH Access with the Direct Console User Interface</guimenuitem></menuchoice>.</simpara>
<note>
<simpara>If your security processes allow you to collect the VMware hypervisors' public keys, save them for <xref linkend="Configuring_the_conversion_hosts"/>.</simpara>
</note>
</listitem>
<listitem>
<simpara>Generate an SSH key pair.</simpara>
</listitem>
<listitem>
<simpara>Copy the public key to all the VMware hypervisors in <literal>/etc/ssh/keys-root/authorized_keys</literal>.</simpara>
</listitem>
</orderedlist>
<simpara>You are ready to prepare the <link linkend="Preparing_the_target_environment">target environment</link>.</simpara>
</section>
</chapter>
<chapter xml:id="Preparing_the_target_environment">
<title>Preparing the target environment</title>
<simpara>Prepare your target environment for migration:</simpara>
<itemizedlist>
<listitem>
<simpara><xref linkend="Preparing_the_rhv_target_environment"/></simpara>
</listitem>
<listitem>
<simpara><xref linkend="Preparing_the_osp_target_environment"/></simpara>
<itemizedlist>
<listitem>
<simpara><xref linkend="Deploying_osp_conversion_hosts"/></simpara>
</listitem>
</itemizedlist>
</listitem>
</itemizedlist>
<section xml:id="Preparing_the_rhv_target_environment">
<title>Preparing the Red Hat Virtualization environment</title>
<simpara>The Red Hat Virtualization environment requires the following preparation:</simpara>
<orderedlist numeration="arabic">
<listitem>
<simpara><link linkend="Installing_and_configuring_red_hat_virtualization">Installing and configuring Red Hat Virtualization</link></simpara>
</listitem>
<listitem>
<simpara><link linkend="Cloudforms_for_rhv">Installing and configuring CloudForms</link></simpara>
</listitem>
<listitem>
<simpara><link linkend="Reinstalling_ipa_client">Reinstalling <literal>ipa-client</literal></link></simpara>
</listitem>
</orderedlist>
<formalpara xml:id="Target_prerequisites_rhv">
<title>Prerequisites</title>
<para>The following prerequisites apply:</para>
</formalpara>
<itemizedlist>
<listitem>
<simpara>Compatible software versions</simpara>
<table frame="all" rowsep="1" colsep="1">
<title>Software compatibility matrix</title>
<tgroup cols="3">
<colspec colname="col_1" colwidth="50*"/>
<colspec colname="col_2" colwidth="25*"/>
<colspec colname="col_3" colwidth="25*"/>
<thead>
<row>
<entry align="left" valign="top">Software</entry>
<entry align="left" valign="top">IMS 1.0</entry>
<entry align="left" valign="top">IMS 1.1</entry>
</row>
</thead>
<tbody>
<row>
<entry align="left" valign="top"><simpara>VMware</simpara></entry>
<entry align="left" valign="top"><simpara>5.5 or later</simpara></entry>
<entry align="left" valign="top"><simpara>5.5 or later</simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara>Red Hat Virtualization</simpara></entry>
<entry align="left" valign="top"><simpara>4.2.7</simpara></entry>
<entry align="left" valign="top"><simpara>4.2.8</simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara>CloudForms</simpara></entry>
<entry align="left" valign="top"><simpara>4.6</simpara></entry>
<entry align="left" valign="top"><simpara>4.7</simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara>OpenStack Platform</simpara></entry>
<entry align="left" valign="top"><simpara>N/A</simpara></entry>
<entry align="left" valign="top"><simpara>13 or later</simpara></entry>
</row>
</tbody>
</tgroup>
</table>
</listitem>
<listitem>
<simpara>BIOS settings of physical hosts adjusted for optimal performance (rather than power-saving), according to the vendor’s recommendations</simpara>
</listitem>
<listitem>
<simpara>C1E halt state disabled, if applicable</simpara>
</listitem>
</itemizedlist>
<orderedlist xml:id="Installing_and_configuring_red_hat_virtualization" numeration="arabic">
<title>Installing and configuring Red Hat Virtualization</title>
<listitem>
<simpara>Install Red Hat Virtualization Manager 4.2 on the Manager machine (see <link xlink:href="https://access.redhat.com/documentation/en-us/red_hat_virtualization/4.2/html-single/installation_guide/#part-Installing_the_Red_Hat_Virtualization_Manager">Installing the Red Hat Virtualization Manager</link> in the <emphasis>Red Hat Virtualization Installation Guide</emphasis>).</simpara>
</listitem>
<listitem>
<simpara>Install Red Hat Virtualization Host 4.2 or Red Hat Enterprise Linux 7.6 on physical machines (see <link xlink:href="https://access.redhat.com/documentation/en-us/red_hat_virtualization/4.2/html-single/installation_guide/#Installing_RHVH">Installing Red Hat Virtualization Host</link> or <link xlink:href="https://access.redhat.com/documentation/en-us/red_hat_virtualization/4.2/html-single/installation_guide/#Red_Hat_Enterprise_Linux_Hosts">Installing Red Hat Enterprise Linux Hosts</link> in the <emphasis>Red Hat Virtualization Installation Guide</emphasis>).</simpara>
<note>
<simpara>Some of these hosts will be deployed as conversion hosts. The number of conversion hosts depends on your migration size and infrastructure capabilities. See <xref linkend="Deciding_how_many_conversion_hosts_to_create"/> for details.</simpara>
</note>
</listitem>
<listitem>
<simpara>Enable the following ports in the conversion host network (see <link xlink:href="https://access.redhat.com/articles/417343">https://access.redhat.com/articles/417343</link>):</simpara>
<itemizedlist>
<listitem>
<simpara>22 - SSH</simpara>
</listitem>
<listitem>
<simpara>443 - CloudForms, Red Hat Virtualization Manager, and VDDK</simpara>
</listitem>
<listitem>
<simpara>902 - CloudForms to VMware</simpara>
</listitem>
<listitem>
<simpara>5480 - Conversion hosts to vCenter</simpara>
</listitem>
</itemizedlist>
</listitem>
<listitem>
<simpara>Create and attach data and ISO storage domains to the data center, ensuring that the data domains have sufficient space for the migrated virtual machines (see <link xlink:href="https://access.redhat.com/documentation/en-us/red_hat_virtualization/4.2/html-single/administration_guide/#chap-Storage">Storage</link> in the <emphasis>Red Hat Virtualization Administration Guide</emphasis>).</simpara>
<note>
<simpara>IMS only supports shared storage, such as NFS, iSCSI, or FCP. Local storage is not supported.</simpara>
</note>
</listitem>
<listitem>
<simpara>Upload the VirtIO and Guest Tool image files to the ISO storage domain (see <link xlink:href="https://access.redhat.com/documentation/en-us/red_hat_virtualization/4.2/html-single/administration_guide/#Uploading_the_VirtIO_and_Guest_Tool_Image_Files_to_an_ISO_Storage_Domain">Uploading the VirtIO and Guest Tool Image Files to an ISO Storage Domain</link> in the <emphasis>Red Hat Virtualization Administration Guide</emphasis>). The VirtIO file name must include the version number: <literal>virtio-win-<emphasis>version</emphasis>.iso</literal>. The Guest Tool is required for migrating Windows virtual machines.</simpara>
</listitem>
<listitem>
<simpara>Optionally, you can create a MAC address pool that includes the MAC addresses of the VMware virtual machines to be migrated (see <link xlink:href="https://access.redhat.com/documentation/en-us/red_hat_virtualization/4.2/html/administration_guide/sect-mac_address_pools#Creating_MAC_Address_Pools">Creating MAC Address Pools</link> in the <emphasis>Red Hat Virtualization Administration Guide</emphasis>).</simpara>
<important>
<simpara>If the RHV MAC address pool range overlaps the VMware MAC address range, you must ensure that the MAC addresses of the migrating virtual machines do not duplicate those of existing virtual machines. Otherwise, the migration will fail.</simpara>
<simpara>If you do not create a MAC address pool, the migrated virtual machines will not have MAC addresses in the same range as virtual machines created in RHV.</simpara>
</important>
</listitem>
</orderedlist>
<formalpara xml:id="Reinstalling_ipa_client">
<title>Reinstalling <literal>ipa-client</literal></title>
<para>If you have configured SSSD with single sign-on on the conversion hosts, reinstall <literal>ipa-client</literal> without configuring the OpenSSH client. Otherwise, SSH will fail for the vdsm user (see <link xlink:href="https://bugzilla.redhat.com/show_bug.cgi?id=1544379">https://bugzilla.redhat.com/show_bug.cgi?id=1544379</link>). This issue cannot be resolved by modifying the configuration file because the file is restored during upgrades.</para>
</formalpara>
<simpara>On the Manager machine, run the following commands:</simpara>
<screen># ipa-client-install --uninstall
# ipa-client-install --no-ssh</screen>
<orderedlist xml:id="Cloudforms_for_rhv" numeration="arabic">
<title>Installing and configuring CloudForms</title>
<listitem>
<simpara>Install Red Hat CloudForms 4.7 on the Manager machine (see <link xlink:href="https://access.redhat.com/documentation/en-us/red_hat_cloudforms/4.7/html/installing_red_hat_cloudforms_on_red_hat_virtualization">Installing Red Hat CloudForms on Red Hat Virtualization</link>).</simpara>
</listitem>
<listitem>
<simpara>Add VMware and Red Hat Virtualization as providers (see <link xlink:href="https://access.redhat.com/documentation/en-us/red_hat_cloudforms/4.7/html-single/managing_providers/#vmware_vcenter_providers">Adding a VMware vCenter Provider</link> and <link xlink:href="https://access.redhat.com/documentation/en-us/red_hat_cloudforms/4.7/html-single/managing_providers/#adding_a_red_hat_virtualization_provider">Adding a Red Hat Virtualization Provider</link> in <emphasis>Red Hat CloudForms: Managing Providers</emphasis>) .</simpara>
<note>
<simpara>Removing or changing a provider, including refreshing hosts, before, during, or after the migration will cause errors in the infrastructure mappings and migration plans.</simpara>
</note>
<simpara>You are ready to <link linkend="Configuring_the_rhv_conversion_hosts">configure the conversion hosts for VDDK or SSH</link>.</simpara>
</listitem>
</orderedlist>
</section>
<section xml:id="Preparing_the_osp_target_environment">
<title>Preparing the Red Hat OpenStack Platform environment</title>
<simpara>The OpenStack Platform environment requires the following preparation:</simpara>
<orderedlist numeration="arabic">
<listitem>
<simpara><link linkend="Installing_and_configuring_open_stack_platform">Installing and configuring OpenStack Platform</link></simpara>
</listitem>
<listitem>
<simpara><link linkend="Cloudforms_for_osp">Installing and configuring CloudForms</link></simpara>
</listitem>
<listitem>
<simpara><link linkend="Deploying_osp_conversion_hosts">Deploying the OpenStack Platform conversion hosts</link></simpara>
</listitem>
</orderedlist>
<formalpara xml:id="Target_prerequisites_osp">
<title>Prerequisites</title>
<para>The following prerequisites apply:</para>
</formalpara>
<itemizedlist>
<listitem>
<simpara>Compatible software versions</simpara>
<table frame="all" rowsep="1" colsep="1">
<title>Software compatibility matrix</title>
<tgroup cols="3">
<colspec colname="col_1" colwidth="50*"/>
<colspec colname="col_2" colwidth="25*"/>
<colspec colname="col_3" colwidth="25*"/>
<thead>
<row>
<entry align="left" valign="top">Software</entry>
<entry align="left" valign="top">IMS 1.0</entry>
<entry align="left" valign="top">IMS 1.1</entry>
</row>
</thead>
<tbody>
<row>
<entry align="left" valign="top"><simpara>VMware</simpara></entry>
<entry align="left" valign="top"><simpara>5.5 or later</simpara></entry>
<entry align="left" valign="top"><simpara>5.5 or later</simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara>Red Hat Virtualization</simpara></entry>
<entry align="left" valign="top"><simpara>4.2.7</simpara></entry>
<entry align="left" valign="top"><simpara>4.2.8</simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara>CloudForms</simpara></entry>
<entry align="left" valign="top"><simpara>4.6</simpara></entry>
<entry align="left" valign="top"><simpara>4.7</simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara>OpenStack Platform</simpara></entry>
<entry align="left" valign="top"><simpara>N/A</simpara></entry>
<entry align="left" valign="top"><simpara>13 or later</simpara></entry>
</row>
</tbody>
</tgroup>
</table>
</listitem>
<listitem>
<simpara>BIOS settings of physical hosts adjusted for optimal performance (rather than power-saving), according to the vendor’s recommendations</simpara>
</listitem>
<listitem>
<simpara>C1E halt state disabled, if applicable</simpara>
</listitem>
</itemizedlist>
<orderedlist xml:id="Installing_and_configuring_open_stack_platform" numeration="arabic">
<title>Installing and configuring OpenStack Platform</title>
<listitem>
<simpara>Install Red Hat OpenStack Platform 13 or 14 (see <link xlink:href="https://access.redhat.com/documentation/en-us/red_hat_openstack_platform/14/html-single/director_installation_and_usage/">Red Hat OpenStack Platform Director Installation and Usage</link>).</simpara>
</listitem>
<listitem>
<simpara>Create provider networks for the target instances to preserve the IP addresses of the source virtual machines (see <link xlink:href="https://access.redhat.com/documentation/en-us/red_hat_openstack_platform/14/html-single/networking_guide/#create_a_network">Create a network</link> in the <emphasis>Red Hat OpenStack Platform Networking Guide</emphasis>).</simpara>
</listitem>
<listitem>
<simpara>Create a project for the conversion hosts and whatever destination projects you require for the target instances (see <link xlink:href="https://access.redhat.com/documentation/en-us/red_hat_openstack_platform/14/html-single/users_and_identity_management_guide/#create_a_project">Create a Project</link> in the <emphasis>Red Hat OpenStack Platform Users and Identity Management Guide</emphasis>).</simpara>
</listitem>
<listitem>
<simpara>Ensure that the <literal>admin</literal> user has <literal>member</literal> and <literal>admin</literal> roles in the conversion and destination projects (see <link xlink:href="https://access.redhat.com/documentation/en-us/red_hat_openstack_platform/14/html-single/users_and_identity_management_guide/#edit_a_project">Edit a Project</link> in the <emphasis>Red Hat OpenStack Platform Users and Identity Management Guide</emphasis>).</simpara>
</listitem>
<listitem>
<simpara>Set at least one volume type for the target block storage (see <link xlink:href="https://access.redhat.com/documentation/en-us/red_hat_openstack_platform/14/html-single/storage_guide/#section-create-volume">Create a Volume</link> and <link xlink:href="https://access.redhat.com/documentation/en-us/red_hat_openstack_platform/14/html-single/storage_guide/#section-volume-retype">Changing a Volume’s Type (Volume Re-typing)</link> in the <emphasis>Red Hat OpenStack Platform Storage Guide</emphasis>). Otherwise, CloudForms cannot detect the storage when you create the infrastructure mapping.</simpara>
</listitem>
<listitem>
<simpara>Ensure that the storage backends have sufficient space for the migrated virtual machines.</simpara>
<important>
<simpara>If you are using Ceph storage, you will require three times the space of the source virtual machines for the migrated virtual machines. Ceph, by default, creates two replicas of an object, for a total of three copies (see <link xlink:href="https://access.redhat.com/documentation/en-us/red_hat_ceph_storage/3/html-single/storage_strategies_guide/index#get_the_number_of_object_replicas">Get the Number of Object Replicas</link> in the <emphasis>Red Hat Ceph Storage: Storage Strategies Guide</emphasis>).</simpara>
<simpara>The migrated virtual machines use all of the space because it is preallocated. For example, if you migrate a virtual machine with a 100 GB disk, you will require 300 GB of Ceph storage, regardless of how much data is on the disk.</simpara>
<simpara>You can use the <literal>fstrim</literal> command on the migrated virtual machines to reduce the space required, as a postmigration task or playbook.</simpara>
</important>
</listitem>
<listitem>
<simpara>Configure security groups with the following ports enabled:</simpara>
<itemizedlist>
<listitem>
<simpara>For the conversion hosts and CloudForms: port 22 (SSH)</simpara>
</listitem>
<listitem>
<simpara>For CloudForms: port 443 (HTTPS)</simpara>
<note>
<simpara>Outbound traffic is enabled by default. If you have changed this setting, enable ports 902 (CloudForms to VMware) and 5480 (conversion hosts to vCenter).</simpara>
</note>
</listitem>
</itemizedlist>
</listitem>
<listitem>
<simpara>Create flavors for the source virtual machines. If you do not create custom flavors, CloudForms will try to map each source virtual machine to an existing flavor.</simpara>
</listitem>
</orderedlist>
<orderedlist xml:id="Cloudforms_for_osp" numeration="arabic">
<title>Installing and configuring CloudForms</title>
<listitem>
<simpara>Install Red Hat CloudForms 4.7 (see <link xlink:href="https://access.redhat.com/documentation/en-us/red_hat_cloudforms/4.7/html-single/installing_red_hat_cloudforms_on_red_hat_openstack_platform/">Installing Red Hat CloudForms on Red Hat OpenStack Platform</link>).</simpara>
</listitem>
<listitem>
<simpara>Add VMware and OpenStack Platform as providers (see <link xlink:href="https://access.redhat.com/documentation/en-us/red_hat_cloudforms/4.7/html-single/managing_providers/#vmware_vcenter_providers">Adding a VMware vCenter Provider</link> and <link xlink:href="https://access.redhat.com/documentation/en-us/red_hat_cloudforms/4.7/html-single/managing_providers/#adding_an_openstack_infrastructure_provider">Adding an OpenStack Infrastructure Provider</link> in <emphasis>Red Hat CloudForms: Managing Providers</emphasis>).</simpara>
<note>
<simpara>Removing or changing a provider before, during, or after the migration will cause errors in the infrastructure mappings and migration plans.</simpara>
</note>
</listitem>
</orderedlist>
<formalpara xml:id="Deploying_osp_conversion_hosts">
<title>Deploying OpenStack Platform conversion hosts</title>
<para>You download the conversion host appliance and use it to deploy the conversion host instances. The number of conversion hosts you deploy depends on your migration size and infrastructure capabilities. See <xref linkend="Deciding_how_many_conversion_hosts_to_create"/> for details.</para>
</formalpara>
<orderedlist numeration="arabic">
<listitem>
<simpara>Navigate to <link xlink:href="https://access.redhat.com/downloads/">https://access.redhat.com/downloads/</link>.</simpara>
</listitem>
<listitem>
<simpara>In the <emphasis role="strong">A-Z</emphasis> tab, click <emphasis role="strong">Red Hat OpenStack Platform</emphasis>.</simpara>
</listitem>
<listitem>
<simpara>Click the green <emphasis role="strong">Download Latest</emphasis> button to go to the OpenStack Platform download page.</simpara>
</listitem>
<listitem>
<simpara>Click the <emphasis role="strong">Product Software</emphasis> tab and download the <literal>RHOSP V2V Image for Red Hat OpenStack Director (x86_64)</literal>.</simpara>
<important>
<simpara>Always download the latest version of the OpenStack Platform conversion appliance because it contains patches and fixes. The OpenStack Platform 14 conversion appliance can be used with both OpenStack Platform 13 and 14.</simpara>
</important>
</listitem>
<listitem>
<simpara>Upload the appliance to Glance storage.</simpara>
</listitem>
<listitem>
<simpara>Deploy the appliance as a conversion host instance, with the following resources:</simpara>
<itemizedlist>
<listitem>
<simpara>4 vCPUs</simpara>
</listitem>
<listitem>
<simpara>1 GB RAM for each concurrent migration, starting at 10 GB RAM (the <link linkend="Changing_the_maximum_number_of_concurrent_migrations">default maximum number of concurrent migrations</link> per conversion host is <literal>10</literal>). If you raise the number of concurrent migrations, you should increase the RAM accordingly. If you lower the number of concurrent conversions, you should not go below 8 GB RAM.</simpara>
</listitem>
<listitem>
<simpara><literal>/tmp</literal> (1 GB for each concurrent migration)</simpara>
</listitem>
<listitem>
<simpara><literal>/var/tmp</literal> (1 GB for each concurrent migration)</simpara>
</listitem>
<listitem>
<simpara><literal>/var/logs</literal> (5 GB)</simpara>
<note>
<simpara>For optimal performance:</simpara>
<itemizedlist>
<listitem>
<simpara>Deploy the conversion hosts on more than one hypervisor.</simpara>
</listitem>
<listitem>
<simpara>Deploy the conversion hosts on a compute node with nested virtualization enabled. See <link xlink:href="https://docs.openstack.org/devstack/latest/guides/devstack-with-nested-kvm.html">https://docs.openstack.org/devstack/latest/guides/devstack-with-nested-kvm.html</link>. Nested virtualization is a technology preview.</simpara>
</listitem>
</itemizedlist>
</note>
</listitem>
</itemizedlist>
</listitem>
<listitem>
<simpara>Increase the disk space of the instance to accommodate its file system.</simpara>
<simpara>The instance is created from an image, but the disk space defined in the image will not be sufficient. You can either extend the partition, and subsequently extend the PV in the VG, to the required size, or you can create a new partition and add it as a PV to the VG.</simpara>
<note>
<simpara>You must resize <literal>lv_root</literal> to use all available disk space because the image will not use it by default.</simpara>
</note>
</listitem>
</orderedlist>
<simpara>You are ready to <link linkend="Configuring_the_osp_conversion_hosts">configure the conversion hosts for VDDK or SSH</link>.</simpara>
</section>
<section xml:id="Configuring_the_conversion_hosts">
<title>Configuring the conversion hosts</title>
<simpara>You can configure the conversion hosts for VDDK or SSH transformation:</simpara>
<itemizedlist>
<listitem>
<simpara><xref linkend="Configuring_the_rhv_conversion_hosts"/></simpara>
</listitem>
<listitem>
<simpara><xref linkend="Configuring_the_osp_conversion_hosts"/></simpara>
<simpara>Optionally, you can verify the name and number of the conversion hosts using an API call in a browser. See <xref linkend="Verifying_conversion_hosts"/>. (This does not verify the VDDK or SSH configuration. That task is performed by the <literal>conversion_host_check</literal> playbook.)</simpara>
</listitem>
</itemizedlist>
<section xml:id="Configuring_the_rhv_conversion_hosts">
<title>Configuring the Red Hat Virtualization conversion hosts</title>
<simpara>Configuring the Red Hat Virtualization conversion hosts for VDDK or SSH transformation involves the following steps:</simpara>
<orderedlist numeration="arabic">
<listitem>
<simpara>VDDK only: <link linkend="rhv_vddk_download">Downloading the VMware Virtual Disk Development Kit</link></simpara>
</listitem>
<listitem>
<simpara><link linkend="Configuring_the_conversion_hosts">Configuring the conversion hosts</link>:</simpara>
<orderedlist numeration="loweralpha">
<listitem>
<simpara>Installing the <literal>ovirt-ansible-v2v-conversion-host</literal> package</simpara>
</listitem>
<listitem>
<simpara>Creating the <literal>extra_vars.yml</literal> and <literal>secure_vars.yml</literal> files</simpara>
</listitem>
<listitem>
<simpara>Configuring the conversion host with the <literal>conversion_host_enable</literal> playbook</simpara>
</listitem>
<listitem>
<simpara>Verifying the configuration with the <literal>conversion_host_check</literal> playbook</simpara>
</listitem>
<listitem>
<simpara>SSH only: <link linkend="Copying_the_vmware_keys_for_SSH_for_rhv">Copying the VMware keys to the conversion hosts</link></simpara>
</listitem>
<listitem>
<simpara>SSH only: <link linkend="Configuring_secure_remote_login_to_the_vmware_hypervisors_for_ssh_transformation">Configuring secure remote login to the VMware hypervisors</link></simpara>
</listitem>
</orderedlist>
</listitem>
<listitem>
<simpara><link linkend="Authenticating_the_red_hat_virtualization_conversion_hosts">Authenticating the conversion hosts in CloudForms</link></simpara>
</listitem>
<listitem>
<simpara>(Optional) <link linkend="Verifying_conversion_hosts">Verifying the name and number of conversion hosts</link> in a browser</simpara>
</listitem>
</orderedlist>
<important>
<simpara>If you upgrade the target environment, you should upgrade the conversion hosts so that you have the latest software and critical updates:</simpara>
<orderedlist numeration="arabic">
<listitem>
<simpara>Log in to the Manager machine using SSH.</simpara>
</listitem>
<listitem>
<simpara>Run the following command:</simpara>
<screen># yum update</screen>
</listitem>
</orderedlist>
</important>
<itemizedlist xml:id="rhv_vddk_download">
<title>Prerequisite</title>
<listitem>
<simpara>VDDK only: Download the VMware Virtual Disk Development Kit:</simpara>
<orderedlist numeration="arabic">
<listitem>
<simpara>Navigate to <link xlink:href="https://www.vmware.com/support/pubs/">https://www.vmware.com/support/pubs/</link>.</simpara>
</listitem>
<listitem>
<simpara>Click <emphasis role="strong">VMware SDK &amp; API Product Documentation</emphasis> to expand.</simpara>
</listitem>
<listitem>
<simpara>Click <emphasis role="strong">VMware Virtual Disk Development Kit (VDDK)</emphasis>.</simpara>
</listitem>
<listitem>
<simpara>Click <emphasis role="strong">Latest Releases</emphasis> and select the latest VDDK release.</simpara>
</listitem>
<listitem>
<simpara>Download and save the VDDK package (<literal>VMware-vix-disklib-<emphasis>version</emphasis>.x86_64.tar.gz</literal>), recording its URL.</simpara>
</listitem>
</orderedlist>
</listitem>
</itemizedlist>
<formalpara>
<title>Procedure</title>
<para>Perform the following procedure on the Manager machine:</para>
</formalpara>
<orderedlist numeration="arabic">
<listitem>
<simpara>Install the <literal>ovirt-ansible-v2v-conversion-host</literal> package:</simpara>
<screen># yum install ovirt-ansible-v2v-conversion-host</screen>
</listitem>
<listitem>
<simpara>Create an <literal>extra_vars.yml</literal> file and update its parameters:</simpara>
<screen>---
v2v_host_type: rhevm

# Transport methods to configure on the conversion host. Valid values: `vddk`, `ssh`
v2v_transport_methods:
  - <emphasis>vddk</emphasis>

# Maximum number of concurrent conversions per host. Default is `10`.
v2v_max_concurrent_conversions: <emphasis>10</emphasis>

# File name of VDDK package
v2v_vddk_package_name: "VMware-vix-disklib-<emphasis>version</emphasis>.x86_64.tar.gz"

# URL of VDDK package
v2v_vddk_package_url: "http://<emphasis>path_to_vddk_package</emphasis>/{{ v2v_vddk_package_name }}"

# Name of the CloudForms provider to which the conversion host belongs
manageiq_provider_name: RHV

# Base URL of CloudForms machine
manageiq_url: "https://<emphasis>CloudForms_FQDN</emphasis>"

# Whether to validate certificate of CloudForms server. Default is `true`.
manageiq_validate_certs: <emphasis>false</emphasis>

# To obtain the CloudForms zone ID, run this API call on the CloudForms machine:
# curl -sk -u admin http://<emphasis>CloudForms_FQDN</emphasis>/api/zones/?filter\[\]=name=RHV&amp;expand=resources&amp;attributes=zone
manageiq_zone_id: "42000000000001"

# List of infrastructure providers
# Each provider is a dictionary with 3 attributes: `name`, `hostname`, and `connection_configurations`
manageiq_providers:
  - name: "<emphasis>RHV</emphasis>"
    hostname: <emphasis>Manager_FQDN_or_IP_address</emphasis>
    connection_configurations: <co xml:id="CO1-1"/>
      - endpoint:
          role: "default"
          certificate_authority: | <co xml:id="CO1-2"/>
            -----BEGIN CERTIFICATE-----
            <emphasis>MIIDoDCCAoigAwIBAgIBATANBgkqhkiG9w0BAQsFADA9MRswGQYDVQ....</emphasis>
            -----END CERTIFICATE-----</screen>
<calloutlist>
<callout arearefs="CO1-1">
<para><literal>connection_configurations</literal> has a single endpoint, whose role is <literal>default</literal>.</para>
</callout>
<callout arearefs="CO1-2">
<para>The CA certificate is stored as <literal>/etc/pki/ovirt-engine/apache-ca.pem</literal> on the Manager machine.</para>
</callout>
</calloutlist>
</listitem>
<listitem>
<simpara>Create an encrypted <literal>secure_vars.yml</literal> file:</simpara>
<screen># ansible-vault create secure_vars.yml</screen>
</listitem>
<listitem>
<simpara>Add the following variables to <literal>secure_vars.yml</literal> and save the file:</simpara>
<screen>---
# CloudForms `admin` user, for connecting to CloudForms
manageiq_username: "<emphasis>username</emphasis>"

# CloudForms `admin` password:
manageiq_password: "<emphasis>password</emphasis>"

# SSH private key to connect to VMware hypervisors. Required for both VDDK and SSH. <co xml:id="CO2-1"/>
v2v_ssh_private_key: |
  -----BEGIN RSA PRIVATE KEY-----
  <emphasis>b3BlbnNzaC1rZXktdjEAAAAABG5vbmUAAAAEbm9uZQAAAAAAAAABAAAAlwAAAAdzc2gtcn....</emphasis>
  -----END RSA PRIVATE KEY-----</screen>
<calloutlist>
<callout arearefs="CO2-1">
<para>This is the private key of the SSH key pair that you created in <xref linkend="Configuring_the_vmware_hypervisors_for_ssh_transformation"/>.</para>
</callout>
</calloutlist>
</listitem>
<listitem>
<simpara>Run the <literal>conversion_host_enable</literal> playbook:</simpara>
<screen># ansible-playbook -i <emphasis>conversion_host_FQDN_or_IP</emphasis>, -b \
    -e "ansible_ssh_private_key_file=/etc/pki/ovirt-engine/keys/engine_id_rsa" \
    -e @extra_vars.yml -e @secure_vars.yml --ask-vault-pass \
    /usr/share/ovirt-ansible-v2v-conversion-host/playbooks/conversion_host_enable.yml</screen>
<warning>
<simpara>Running the <literal>conversion_host_enable</literal> playbook more than once on the same host creates multiple entries in the CloudForms database for that host.</simpara>
<simpara>If you need to run the <literal>conversion_host_enable</literal> playbook again, you should remove the existing database entry by running the <literal>conversion_host_disable</literal> playbook on the host:</simpara>
<screen># ansible-playbook /usr/share/ovirt-ansible-v2v-conversion-host/playbooks/conversion_host_disable.yml</screen>
</warning>
</listitem>
<listitem>
<simpara>Run the <literal>conversion_host_check</literal> playbook to verify the conversion host configuration:</simpara>
<screen># ansible-playbook --ask-vault-pass -i <emphasis>conversion_host_FQDN_or_IP</emphasis>, conversion_host_check.yml</screen>
<itemizedlist>
<listitem>
<simpara>If you are using VDDK, you can authenticate the conversion hosts in CloudForms. See <xref linkend="Authenticating_the_red_hat_virtualization_conversion_hosts"/>.</simpara>
</listitem>
<listitem>
<simpara>If you are using SSH, you are ready to copy the VMware keys to the conversion hosts. See <xref linkend="Copying_the_vmware_keys_for_SSH_for_rhv"/>.</simpara>
</listitem>
</itemizedlist>
</listitem>
</orderedlist>
<formalpara xml:id="Copying_the_vmware_keys_for_SSH_for_rhv">
<title>Copying the VMware keys for Red Hat Virtualization</title>
<para>To prevent man-in-the-middle attacks, the conversion hosts do not accept the VMware keys by default for SSH transformation. Instead, the <literal>known_hosts</literal> file of each conversion host must be populated with the public keys of the VMware hypervisors.</para>
</formalpara>
<simpara>Depending on the security processes of your VMware environment, you can either obtain a list of public keys from the VMware system administrators, if they collected the keys when they <link linkend="Configuring_the_vmware_hypervisors_for_ssh_transformation">enabled SSH access on the hypervisors</link>, or you can use <literal>ssh-keyscan</literal>.</simpara>
<warning>
<simpara>You must run <literal>ssh-keyscan</literal> multiple times, once for each VMware hypervisor. Otherwise your conversion hosts will not have all the VMware keys and the migration will fail.</simpara>
</warning>
<simpara>Perform the following procedure on the Manager machine:</simpara>
<orderedlist numeration="arabic">
<listitem>
<simpara>Run <literal>ssh-keyscan</literal> for each VMware hypervisor and output the public key to <literal>known_hosts</literal>, as in the following example:</simpara>
<screen># ssh-keyscan <emphasis>esx1.example.com</emphasis> &gt; /var/lib/vdsm/.ssh/known_hosts
# ssh-keyscan <emphasis>esx2.example.com</emphasis> &gt;&gt; /var/lib/vdsm/.ssh/known_hosts
# ssh-keyscan <emphasis>esx3.example.com</emphasis> &gt;&gt; /var/lib/vdsm/.ssh/known_hosts</screen>
</listitem>
<listitem>
<simpara>Change the ownership of the <literal>known_hosts</literal> file to user <literal>vdsm</literal> and group <literal>kvm</literal>:</simpara>
<screen># chown 36:36 /var/lib/vdsm/.ssh/known_hosts</screen>
</listitem>
</orderedlist>
<formalpara xml:id="Configuring_secure_remote_login_to_the_vmware_hypervisors_for_ssh_transformation">
<title>Configuring secure remote login to the VMware hypervisors for SSH transformation</title>
<para>Perform the following procedure on the Manager machine:</para>
</formalpara>
<orderedlist numeration="arabic">
<listitem>
<simpara>Enter the following command:</simpara>
<screen># sudo -u vdsm ssh-agent</screen>
<simpara>The command returns this output:</simpara>
<screen>SSH_AUTH_SOCK=<emphasis>socket_domain</emphasis>; export SSH_AUTH_SOCK; <co xml:id="CO3-1"/>
SSH_AGENT_PID=139150; export SSH_AGENT_PID;
echo Agent pid 139150;</screen>
<calloutlist>
<callout arearefs="CO3-1">
<para>The <literal>socket_domain</literal> format is <literal>/tmp/ssh-<emphasis>socket_number</emphasis>/agent.<emphasis>pid</emphasis></literal>.</para>
</callout>
</calloutlist>
</listitem>
<listitem>
<simpara>Enter the following commands, copying the <emphasis>socket_domain</emphasis> from the output, to validate the SSH configuration for each VMware hypervisor:</simpara>
<screen># sudo -u vdsm SSH_AUTH_SOCK=<emphasis>socket_domain</emphasis> ssh-add
# sudo -u vdsm \
    SSH_AUTH_SOCK=<emphasis>socket_domain</emphasis> ssh root@<emphasis>esx1.example.com</emphasis></screen>
<important>
<simpara>These commands must be run for each VMware hypervisor.</simpara>
<simpara>If the last command fails, all migrations from this VMware hypervisor using SSH transformation will fail. Check the following procedures:</simpara>
<itemizedlist>
<listitem>
<simpara><xref linkend="Configuring_the_vmware_hypervisors_for_ssh_transformation"/></simpara>
</listitem>
<listitem>
<simpara><xref linkend="Copying_the_vmware_keys_for_SSH_for_rhv"/></simpara>
</listitem>
</itemizedlist>
</important>
<simpara>If the SSH connection is successful, you can authenticate the conversion hosts in CloudForms. See <xref linkend="Authenticating_the_red_hat_virtualization_conversion_hosts"/>.</simpara>
</listitem>
</orderedlist>
<formalpara xml:id="Authenticating_the_red_hat_virtualization_conversion_hosts">
<title>Authenticating the Red Hat Virtualization conversion hosts in CloudForms</title>
<para>Perform the following procedure for each Red Hat Virtualization conversion host:</para>
</formalpara>
<orderedlist numeration="arabic">
<listitem>
<simpara>Click <menuchoice><guimenu>Compute</guimenu> <guisubmenu>Infrastructure</guisubmenu> <guimenuitem>Hosts</guimenuitem></menuchoice> and select a Red Hat Virtualization conversion host.</simpara>
</listitem>
<listitem>
<simpara>Click the <emphasis role="strong">Configuration</emphasis> drop-down button and select <emphasis role="strong">Edit Selected items</emphasis>.</simpara>
</listitem>
<listitem>
<simpara>In the <emphasis role="strong">Default</emphasis> tab of the Endpoints section, enter the <emphasis role="strong">Username</emphasis> and the <emphasis role="strong">Password</emphasis> for <literal>root</literal>.</simpara>
</listitem>
<listitem>
<simpara>Click <emphasis role="strong">Validate</emphasis> and wait for validation to complete.</simpara>
</listitem>
<listitem>
<simpara>Click <emphasis role="strong">Save</emphasis>.</simpara>
</listitem>
</orderedlist>
<simpara>You can create an infrastructure mapping. See <xref linkend="Creating_an_infrastructure_mapping"/>.</simpara>
<simpara>Optionally, you can verify the conversion hosts in a browser. See <xref linkend="Verifying_conversion_hosts"/>.</simpara>
</section>
<section xml:id="Configuring_the_osp_conversion_hosts">
<title>Configuring the OpenStack Platform conversion hosts</title>
<simpara>Configuring the OpenStack Platform conversion hosts for VDDK or SSH transformation involves the following steps:</simpara>
<orderedlist numeration="arabic">
<listitem>
<simpara>VDDK only: <link linkend="osp_vddk_download">Downloading the VMware Virtual Disk Development Kit</link></simpara>
</listitem>
<listitem>
<simpara><link linkend="Configuring_the_conversion_hosts">Configuring the conversion hosts</link>:</simpara>
<orderedlist numeration="loweralpha">
<listitem>
<simpara>Creating the <literal>extra_vars.yml</literal> and <literal>secure_vars.yml</literal> files</simpara>
</listitem>
<listitem>
<simpara>Configuring the conversion host with the <literal>conversion_host_enable</literal> playbook</simpara>
</listitem>
<listitem>
<simpara>Verifying the configuration with the <literal>conversion_host_check</literal> playbook</simpara>
</listitem>
<listitem>
<simpara>SSH only: <link linkend="Copying_the_vmware_keys_for_SSH_for_osp">Copying the VMware keys to the conversion hosts</link></simpara>
</listitem>
</orderedlist>
</listitem>
<listitem>
<simpara>(Optional) <link linkend="Verifying_conversion_hosts">Verifying the name and number of conversion hosts</link> in a browser</simpara>
</listitem>
</orderedlist>
<important>
<simpara>If you upgrade the target environment, you should upgrade the conversion hosts so that you have the latest software and critical updates:</simpara>
<orderedlist numeration="arabic">
<listitem>
<simpara>Download the latest conversion host appliance.</simpara>
</listitem>
<listitem>
<simpara>Redeploy the conversion hosts. See <link linkend="Deploying_osp_conversion_hosts">Deploying the OpenStack Platform conversion hosts</link>.</simpara>
</listitem>
</orderedlist>
</important>
<itemizedlist xml:id="osp_vddk_download">
<title>Prerequisite</title>
<listitem>
<simpara>VDDK only: Download the VMware Virtual Disk Development Kit:</simpara>
<orderedlist numeration="arabic">
<listitem>
<simpara>Navigate to <link xlink:href="https://www.vmware.com/support/pubs/">https://www.vmware.com/support/pubs/</link>.</simpara>
</listitem>
<listitem>
<simpara>Click <emphasis role="strong">VMware SDK &amp; API Product Documentation</emphasis> to expand.</simpara>
</listitem>
<listitem>
<simpara>Click <emphasis role="strong">VMware Virtual Disk Development Kit (VDDK)</emphasis>.</simpara>
</listitem>
<listitem>
<simpara>Click <emphasis role="strong">Latest Releases</emphasis> and select the latest VDDK release.</simpara>
</listitem>
<listitem>
<simpara>Download and save the VDDK package (<literal>VMware-vix-disklib-<emphasis>version</emphasis>.x86_64.tar.gz</literal>), recording its URL.</simpara>
</listitem>
</orderedlist>
</listitem>
</itemizedlist>
<formalpara>
<title>Procedure</title>
<para>Perform the following procedure on each conversion host:</para>
</formalpara>
<orderedlist numeration="arabic">
<listitem>
<simpara>Go to <literal>/usr/share/ovirt-ansible-v2v-conversion-host/playbooks</literal>.</simpara>
</listitem>
<listitem>
<simpara>Create an <literal>extra_vars.yml</literal> file and update its parameters:</simpara>
<screen>---
v2v_host_type: openstack

# Transport methods to configure on the conversion host. Valid values: `vddk`, `ssh`
v2v_transport_methods:
  - <emphasis>vddk</emphasis>

# Maximum number of concurrent conversions per host. Default is `10`.
v2v_max_concurrent_conversions: <emphasis>10</emphasis>

# File name of VDDK package
v2v_vddk_package_name: "VMware-vix-disklib-<emphasis>version</emphasis>.x86_64.tar.gz"

# URL of VDDK package
v2v_vddk_package_url: "http://<emphasis>path/to/downloaded_vddk_package</emphasis>/{{ v2v_vddk_package_name }}"

manageiq_provider_name: OpenStack

# Base URL of CloudForms machine
manageiq_url: "https://<emphasis>CloudForms_FQDN</emphasis>"

# Whether to validate certificate of CloudForms server. Default is `true`.
manageiq_validate_certs: <emphasis>false</emphasis>
manageiq_zone_id: "42000000000001"

# List of cloud providers
# Each provider is a dictionary with 3 attributes: `name`, `hostname`, and `connection_configurations`
manageiq_providers:
  - name: "<emphasis>OpenStack</emphasis>"
    hostname: <emphasis>controller_node_FQDN_or_IP_address</emphasis>
    connection_configurations: <co xml:id="CO4-1"/>
      - endpoint:
          role: "default"
          security_protocol: "ssl" <co xml:id="CO4-2"/>
          certificate_authority: | <co xml:id="CO4-3"/>
            -----BEGIN TRUSTED CERTIFICATE-----
            <emphasis>MIIDNzCCAh8CAQEwDQYJKoZIhvcNAQELBQAwYjELMAkGA1UEBhMCVV....</emphasis>
            -----END TRUSTED CERTIFICATE-----
            -----BEGIN TRUSTED CERTIFICATE-----
            <emphasis>MIIDlzCCAn+gAwIBAgIJAOP7AaT7dsLYMA0GCSqGSIb3DQEBCwUAMG....</emphasis>
            -----END TRUSTED CERTIFICATE-----</screen>
<calloutlist>
<callout arearefs="CO4-1">
<para><literal>connection_configurations</literal> has a single endpoint, whose role is <literal>default</literal>.</para>
</callout>
<callout arearefs="CO4-2">
<para>You can specify the connection security: <literal>non-ssl</literal>, <literal>ssl-without-validation</literal>, or <literal>ssl</literal>. If you choose <literal>ssl</literal>, add the CA chain (<literal>certificate_authority</literal>)</para>
</callout>
<callout arearefs="CO4-3">
<para>The CA chain (<literal>certificate_authority</literal>) is a concatenation of two CA files:</para>
<itemizedlist>
<listitem>
<simpara><literal>/etc/pki/ca-trust/source/anchors/undercloud-cacert.pem</literal> on the undercloud server</simpara>
</listitem>
<listitem>
<simpara><literal>/etc/pki/ca-trust/anchors/overcloud-cacert.pem</literal> on one of the overcloud controllers</simpara>
<simpara>If you deploy your own CA chain, use the chain that signs the OpenStack Platform API certificates (see <link xlink:href="https://access.redhat.com/documentation/en-us/red_hat_openstack_platform/14/html-single/director_installation_and_usage/index#appe-SSLTLS_Certificate_Configuration">SSL/TLS Certificate Configuration</link> in <emphasis>Red Hat OpenStack Platform Director Installation and Usage</emphasis>).</simpara>
</listitem>
</itemizedlist>
</callout>
</calloutlist>
</listitem>
<listitem>
<simpara>Create an encrypted <literal>secure_vars.yml</literal> file:</simpara>
<screen># ansible-vault create secure_vars.yml</screen>
</listitem>
<listitem>
<simpara>Add the following variables to <literal>secure_vars.yml</literal> and save the file:</simpara>
<screen>---
# CloudForms `admin` user, for connecting to CloudForms
manageiq_username: "<emphasis>username</emphasis>"

# CloudForms `admin` password:
manageiq_password: "<emphasis>password</emphasis>"

# SSH private key to connect to VMware hypervisors. Required for both VDDK and SSH. <co xml:id="CO5-1"/>
v2v_ssh_private_key: |
  -----BEGIN RSA PRIVATE KEY-----
  <emphasis>b3BlbnNzaC1rZXktdjEAAAAABG5vbmUAAAAEbm9uZQAAAAAAAAABAAAAlwAAAAdzc2gtcn....</emphasis>
  -----END RSA PRIVATE KEY-----</screen>
<calloutlist>
<callout arearefs="CO5-1">
<para>This is the private key of the SSH key pair that you created in <xref linkend="Configuring_the_vmware_hypervisors_for_ssh_transformation"/>.</para>
</callout>
</calloutlist>
</listitem>
<listitem>
<simpara>Run the <literal>conversion_host_enable</literal> playbook:</simpara>
<screen># ansible-playbook -i <emphasis>conversion_host_FQDN_or_IP</emphasis>, -c local -b \
    -e @extra_vars.yml -e @secure_vars.yml --ask-vault-pass \
    /usr/share/ovirt-ansible-v2v-conversion-host/playbooks/conversion_host_enable.yml</screen>
<warning>
<simpara>Running the <literal>conversion_host_enable</literal> playbook more than once on the same host creates multiple entries in the CloudForms database for that host.</simpara>
<simpara>If you need to run the <literal>conversion_host_enable</literal> playbook again, you should remove the existing database entry by running the <literal>conversion_host_disable</literal> playbook on the host:</simpara>
<screen># ansible-playbook /usr/share/ovirt-ansible-v2v-conversion-host/playbooks/conversion_host_disable.yml</screen>
</warning>
</listitem>
<listitem>
<simpara>Run the <literal>conversion_host_check</literal> playbook to verify the conversion host configuration:</simpara>
<screen># ansible-playbook --ask-vault-pass -i <emphasis>conversion_host_FQDN_or_IP</emphasis>, conversion_host_check.yml</screen>
<itemizedlist>
<listitem>
<simpara>If you are using VDDK, you can create an infrastructure mapping. See <xref linkend="Creating_an_infrastructure_mapping"/>.</simpara>
</listitem>
<listitem>
<simpara>If you are using SSH, you are ready to copy the VMware keys to the conversion hosts. See <xref linkend="Copying_the_vmware_keys_for_SSH_for_osp"/>.</simpara>
</listitem>
</itemizedlist>
</listitem>
</orderedlist>
<formalpara xml:id="Copying_the_vmware_keys_for_SSH_for_osp">
<title>Copying the VMware keys for OpenStack Platform</title>
<para>To prevent man-in-the-middle attacks, the conversion hosts do not accept the VMware keys by default for SSH transformation. Instead, the <literal>known_hosts</literal> file of each conversion host must be populated with the public keys of the VMware hypervisors.</para>
</formalpara>
<simpara>Depending on the security processes of your VMware environment, you can either obtain a list of public keys from the VMware system administrators, if they collected the keys when they <link linkend="Configuring_the_vmware_hypervisors_for_ssh_transformation">enabled SSH access on the hypervisors</link>, or you can use <literal>ssh-keyscan</literal>.</simpara>
<warning>
<simpara>You must run <literal>ssh-keyscan</literal> multiple times, once for each VMware hypervisor. Otherwise your conversion hosts will not have all the VMware keys and the migration will fail.</simpara>
</warning>
<simpara>Perform the following procedure on a conversion host:</simpara>
<orderedlist numeration="arabic">
<listitem>
<simpara>Run <literal>ssh-keyscan</literal> for each VMware hypervisor and output the public key to <literal>known_hosts</literal>, as in the following example:</simpara>
<screen># ssh-keyscan <emphasis>esx1.example.com</emphasis> &gt; /root/.ssh/known_hosts
# ssh-keyscan <emphasis>esx2.example.com</emphasis> &gt;&gt; /root/.ssh/known_hosts
# ssh-keyscan <emphasis>esx3.example.com</emphasis> &gt;&gt; /root/.ssh/known_hosts</screen>
</listitem>
<listitem>
<simpara>Repeat the procedure on each conversion host, to ensure that all the conversion hosts have all the VMware keys.</simpara>
</listitem>
<listitem>
<simpara>Connect to each VMware hypervisor from each conversion host as <literal>cloud-user</literal> to verify the SSH connection.</simpara>
<important>
<simpara>If the SSH connection to a VMware hypervisor fails, check <xref linkend="Configuring_the_vmware_hypervisors_for_ssh_transformation"/>.</simpara>
</important>
<simpara>If the connection is successful, you can create an infrastructure mapping. See <xref linkend="Creating_an_infrastructure_mapping"/>.</simpara>
</listitem>
</orderedlist>
</section>
<section xml:id="Verifying_conversion_hosts">
<title>(Optional) Verifying the conversion hosts in a browser</title>
<simpara>This procedure displays the names and number of your conversion hosts. It does not check SSH or VDDK transformation, which is done by the <literal>conversion_host_check</literal> playbook.</simpara>
<simpara>To verify your conversion hosts:</simpara>
<orderedlist numeration="arabic">
<listitem>
<simpara>Enter the following URL in your browser:</simpara>
<screen>https://<emphasis>CloudForms_FQDN</emphasis>/api/conversion_hosts</screen>
</listitem>
<listitem>
<simpara>In the <emphasis role="strong">Sign in</emphasis> window, enter the <emphasis role="strong">Username</emphasis> and <emphasis role="strong">Password</emphasis> and click <emphasis role="strong">Sign in</emphasis>.</simpara>
<simpara>The conversion hosts are displayed in JSON format:</simpara>
<screen>{"name":"conversion_hosts","count":3,"subcount":3,"pages":1,"resources":[{"href":"https://<emphasis>CloudForms_FQDN</emphasis>/api/conversion_hosts/10000000000001"},{"href":"https://<emphasis>CloudForms_FQDN</emphasis>/api/conversion_hosts/10000000000002"},{"href":"https://<emphasis>CloudForms_FQDN</emphasis>/api/conversion_hosts/10000000000003"}],"actions":[{"name":"create","method":"post","href":"https://<emphasis>CloudForms_FQDN</emphasis>/api/conversion_hosts"},{"name":"edit","method":"post","href":"https://<emphasis>CloudForms_FQDN</emphasis>/api/conversion_hosts"},{"name":"delete","method":"post","href":"https://<emphasis>CloudForms_FQDN</emphasis>/api/conversion_hosts"}],"links":{"self":"https://<emphasis>CloudForms_FQDN</emphasis>/api/conversion_hosts?offset=0","first":"https://<emphasis>CloudForms_FQDN</emphasis>/api/conversion_hosts?offset=0","last":"https://<emphasis>CloudForms_FQDN</emphasis>/api/conversion_hosts?offset=0"}}</screen>
</listitem>
</orderedlist>
</section>
</section>
</chapter>
<chapter xml:id="Migrating_the_infrastructure">
<title>Migrating the infrastructure</title>
<note>
<simpara>Performing test migrations with different maximum numbers of concurrent migrations is highly recommended, to assess the capabilities of your environment’s infrastructure. See <xref linkend="Changing_the_maximum_number_of_concurrent_migrations"/>.</simpara>
</note>
<simpara>Migrating the infrastructure involves the following key tasks:</simpara>
<orderedlist numeration="arabic">
<listitem>
<simpara><xref linkend="Creating_an_infrastructure_mapping"/>, to map the resources of your source environment to your target environment</simpara>
</listitem>
<listitem>
<simpara><xref linkend="Creating_and_running_a_migration_plan"/></simpara>
</listitem>
</orderedlist>
<section xml:id="Creating_an_infrastructure_mapping">
<title>Creating an infrastructure mapping</title>
<simpara>The infrastructure mapping maps your source infrastructure to your target environment.</simpara>
<important>
<simpara>If you add or remove providers or provider objects from an infrastructure mapping, the mapping will have missing resource errors (see <xref linkend="Infrastructure_mapping_errors"/>). You must delete the infrastructure mapping and create a new one.</simpara>
</important>
<orderedlist numeration="arabic">
<title>Procedure</title>
<listitem>
<simpara>Click <menuchoice><guimenu>Compute</guimenu> <guisubmenu>Migration</guisubmenu> <guimenuitem>Infrastructure Mappings</guimenuitem></menuchoice>.</simpara>
</listitem>
<listitem>
<simpara>Click <emphasis role="strong">Create Infrastructure Mapping</emphasis>.</simpara>
</listitem>
<listitem>
<simpara>Perform the following procedures in the <emphasis role="strong">Create Infrastructure Mapping</emphasis> wizard:</simpara>
</listitem>
</orderedlist>
<simpara><inlinemediaobject>
<imageobject>
<imagedata fileref="images/Creating_infrastructure_mapping.png"/>
</imageobject>
<textobject><phrase>Creating infrastructure mapping</phrase></textobject>
</inlinemediaobject></simpara>
<informaltable frame="all" rowsep="1" colsep="1">
<tgroup cols="2">
<colspec colname="col_1" colwidth="25*"/>
<colspec colname="col_2" colwidth="75*"/>
<thead>
<row>
<entry align="center" valign="top">Screen</entry>
<entry align="center" valign="top">Procedure</entry>
</row>
</thead>
<tbody>
<row>
<entry align="left" valign="top"><simpara><emphasis role="strong">General</emphasis></simpara></entry>
<entry align="left" valign="top"><orderedlist numeration="arabic">
<listitem>
<simpara>Enter the infrastructure mapping <emphasis role="strong">Name</emphasis> and (optional) <emphasis role="strong">Description</emphasis>.</simpara>
</listitem>
<listitem>
<simpara>Select the <emphasis role="strong">Target Provider</emphasis>.</simpara>
</listitem>
<listitem>
<simpara>Click <emphasis role="strong">Next</emphasis>.</simpara>
</listitem>
</orderedlist></entry>
</row>
<row>
<entry align="left" valign="top"><simpara><emphasis role="strong">Map Compute</emphasis></simpara></entry>
<entry align="left" valign="top"><orderedlist numeration="arabic">
<listitem>
<simpara>Select a <emphasis role="strong">Source Provider \ Datacenter \ Cluster</emphasis> source cluster and a (RHV) <emphasis role="strong">Target Provider \ Datacenter \ Cluster</emphasis> or (OpenStack Platform) <emphasis role="strong">Target Provider \ Project</emphasis>.</simpara>
<simpara>If the target cluster or project does not contain a conversion host, a warning icon (<inlinemediaobject>
<imageobject>
<imagedata fileref="images/warning.png" contentdepth="15px"/>
</imageobject>
<textobject><phrase>warning</phrase></textobject>
</inlinemediaobject>) appears. You can create and save an infrastructure mapping, but you must <link linkend="Configuring_the_conversion_hosts">configure conversion hosts</link> before you can run a migration plan.</simpara>
</listitem>
<listitem>
<simpara>Click <emphasis role="strong">Add Mapping</emphasis>. You can map additional clusters.</simpara>
</listitem>
<listitem>
<simpara>Click <emphasis role="strong">Next</emphasis>.</simpara>
</listitem>
</orderedlist></entry>
</row>
<row>
<entry align="left" valign="top"><simpara><emphasis role="strong">Map Storage</emphasis></simpara></entry>
<entry align="left" valign="top"><orderedlist numeration="arabic">
<listitem>
<simpara>Select a source cluster whose datastores you want to map.</simpara>
</listitem>
<listitem>
<simpara>Select a <emphasis role="strong">Source Provider \ Datacenter \ Datastore</emphasis> and (RHV) <emphasis role="strong">Target Datastores</emphasis> or
(OpenStack Platform) <emphasis role="strong">Target Provider \ Volume Type</emphasis>. (If the OpenStack Platform volume type is missing, check that the <literal>volume type</literal> has been set. See <xref linkend="Infrastructure_mapping_errors"/>.)</simpara>
</listitem>
<listitem>
<simpara>Click <emphasis role="strong">Add Mapping</emphasis>. You can map additional datastores.</simpara>
</listitem>
<listitem>
<simpara>Click <emphasis role="strong">Next</emphasis>.</simpara>
</listitem>
</orderedlist></entry>
</row>
<row>
<entry align="left" valign="top"><simpara><emphasis role="strong">Map Networks</emphasis></simpara></entry>
<entry align="left" valign="top"><orderedlist numeration="arabic">
<listitem>
<simpara>Select a source cluster from the drop-down list.</simpara>
</listitem>
<listitem>
<simpara>Select one or more from <emphasis role="strong">Source Provider \ Datacenter \ Network</emphasis> and a <emphasis role="strong">Target Project \ Network</emphasis>. (IMS supports both provider and tenant networks in OpenStack Platform.)</simpara>
</listitem>
<listitem>
<simpara>Click <emphasis role="strong">Add Mapping</emphasis>. You can map the networks of additional source clusters.</simpara>
</listitem>
<listitem>
<simpara>Click <emphasis role="strong">Create</emphasis>.</simpara>
</listitem>
</orderedlist></entry>
</row>
<row>
<entry align="left" valign="top"><simpara><emphasis role="strong">Results</emphasis></simpara></entry>
<entry align="left" valign="top"><simpara>Click <emphasis role="strong">Close</emphasis>. Your infrastructure mapping is saved in <menuchoice><guimenu>Compute</guimenu> <guisubmenu>Migration</guisubmenu> <guimenuitem>Infrastructure Mappings</guimenuitem></menuchoice>.</simpara></entry>
</row>
</tbody>
</tgroup>
</informaltable>
<simpara>You can click an infrastructure mapping element to view its details:</simpara>
<formalpara>
<title>Infrastructure Mappings list</title>
<para><inlinemediaobject>
<imageobject>
<imagedata fileref="images/Infra_mappings_list.png"/>
</imageobject>
<textobject><phrase>Infra mappings list</phrase></textobject>
</inlinemediaobject></para>
</formalpara>
<simpara>After you have created an infrastructure mapping, you can <link linkend="Creating_and_running_a_migration_plan">create and run a migration plan</link>.</simpara>
</section>
<section xml:id="Creating_and_running_a_migration_plan">
<title>Creating and running a migration plan</title>
<formalpara>
<title>Prerequisites</title>
<para>Certain prerequisites may apply.</para>
</formalpara>
<simpara>Check your migration for the following conditions:</simpara>
<itemizedlist>
<listitem>
<simpara><emphasis role="strong">You are migrating previously migrated virtual machines</emphasis></simpara>
<simpara>You can previously migrated machines to the migration plan with a CSV file. This is also recommended for large migrations. See <xref linkend="Creating_a_csv_file_to_add_virtual_machines_to_the_migration_plan"/>.</simpara>
</listitem>
<listitem>
<simpara><emphasis role="strong">You are migrating virtual machines running RHEL or other Linux operating system</emphasis></simpara>
<simpara>RHEL/Linux virtual machines require additional configuration to preserve their IP addresses after migration. See <xref linkend="Creating_a_rhel_premigration_playbook"/>.</simpara>
</listitem>
<listitem>
<simpara><emphasis role="strong">You are using Ansible playbooks for premigration/postmigration tasks</emphasis></simpara>
<simpara>You can add an Ansible repository, credentials, and playbooks to CloudForms. See <xref linkend="Adding_ansible_playbooks_to_cloudforms"/>.</simpara>
</listitem>
</itemizedlist>
<simpara>If these conditions do not apply, you are ready to create a migration plan.</simpara>
<formalpara>
<title>Creating and running a migration plan</title>
<para>Creating and running a migration plan involves the following key steps:</para>
</formalpara>
<orderedlist numeration="arabic">
<listitem>
<simpara>Creating a migration plan with the <emphasis role="strong">Create Migration Plan</emphasis> wizard in CloudForms (see <xref linkend="Creating_a_migration_plan"/>)</simpara>
</listitem>
<listitem>
<simpara>Running the migration plan (the last step of the <emphasis role="strong">Create Migration Plan</emphasis> wizard) with one of the following options:</simpara>
<itemizedlist>
<listitem>
<simpara>Saving the migration plan and scheduling it to run in the future (see <xref linkend="Scheduling_a_saved_migration_plan"/>)</simpara>
</listitem>
<listitem>
<simpara>Running the migration plan immediately</simpara>
</listitem>
</itemizedlist>
</listitem>
</orderedlist>
<simpara>Optionally, you can do the following:</simpara>
<itemizedlist>
<listitem>
<simpara><link linkend="Viewing_migration_plan_progress">View a migration plan’s progress</link></simpara>
</listitem>
<listitem>
<simpara><link linkend="Canceling_a_migration_plan">Cancel a migration plan in progress</link></simpara>
</listitem>
<listitem>
<simpara><link linkend="Retrying_a_failed_migration_plan">Retry a migration plan</link> if external factors, such as network disruptions, cause a migration failure</simpara>
</listitem>
</itemizedlist>
<section xml:id="Migration_plan_prerequisites_and_options">
<title>Migration plan prerequisites</title>
<simpara>The migration plan prerequisites apply to the following conditions:</simpara>
<itemizedlist>
<listitem>
<simpara>Migrating previously migrated virtual machines</simpara>
<simpara>See <xref linkend="Creating_a_csv_file_to_add_virtual_machines_to_the_migration_plan"/>.</simpara>
</listitem>
<listitem>
<simpara>Migrating virtual machines running RHEL or other Linux operating system</simpara>
<simpara>See <xref linkend="Creating_a_rhel_premigration_playbook"/>.</simpara>
</listitem>
<listitem>
<simpara>Using Ansible playbooks for premigration/postmigration tasks</simpara>
<simpara>See <xref linkend="Adding_ansible_playbooks_to_cloudforms"/>.</simpara>
</listitem>
</itemizedlist>
<simpara>If these conditions do not apply, you can create a migration plan. See <xref linkend="Creating_a_migration_plan"/>.</simpara>
<section xml:id="Creating_a_csv_file_to_add_virtual_machines_to_the_migration_plan">
<title>Creating a CSV file to add virtual machines to the migration plan</title>
<simpara>If you are migrating virtual machines that were migrated in the past, you should create a CSV file to add the virtual machines to the migration plan, because the migration plan cannot discover them automatically.</simpara>
<note>
<title>Using a CSV file for large migrations (recommended)</title>
<simpara>If you are migrating a large number of virtual machines, using a CSV file to add the virtual machines is faster than selecting them manually.</simpara>
<simpara>For large OpenStack Platform migrations, you can use a CSV file to set the security groups and flavors, instead of setting them individually in CloudForms.</simpara>
</note>
<table frame="all" rowsep="1" colsep="1">
<title>CSV file fields</title>
<tgroup cols="2">
<colspec colname="col_1" colwidth="25*"/>
<colspec colname="col_2" colwidth="75*"/>
<thead>
<row>
<entry align="left" valign="top">Field</entry>
<entry align="left" valign="top">Comments</entry>
</row>
</thead>
<tbody>
<row>
<entry align="left" valign="top"><simpara><literal>Name</literal></simpara></entry>
<entry align="left" valign="top"><simpara>Virtual machine name. <emphasis role="strong">Required</emphasis></simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara><literal>Host</literal></simpara></entry>
<entry align="left" valign="top"><simpara><emphasis role="strong">Optional</emphasis>. Only required if virtual machines have identical <literal>Name</literal> fields.</simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara><literal>Provider</literal></simpara></entry>
<entry align="left" valign="top"><simpara><emphasis role="strong">Optional</emphasis>. Only required if virtual machines have identical <literal>Name</literal> and <literal>Host</literal> fields.</simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara><literal>Security Group</literal></simpara></entry>
<entry align="left" valign="top"><simpara><emphasis role="strong">Optional, for OpenStack Platform only.</emphasis> The default is <literal>Default</literal>.</simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara><literal>Flavor</literal></simpara></entry>
<entry align="left" valign="top"><simpara><emphasis role="strong">Optional, for OpenStack Platform only.</emphasis> If you do not create flavors for the migration or if you leave this field blank, CloudForms tries to map the source virtual machines to existing flavors.</simpara></entry>
</row>
</tbody>
</tgroup>
</table>
<formalpara>
<title>CSV file example</title>
<para>
<screen>Name,Host,Provider,Security Group,Flavor
vm01,host1,vSphere3,webservers,x1.medium
vm02,host1,vSphere3,webservers,x1.medium
vm03,host1,vSphere3,webservers,x1.medium</screen>
</para>
</formalpara>
<simpara>You are ready to create a migration plan. See <xref linkend="Creating_a_migration_plan"/>.</simpara>
</section>
<section xml:id="Creating_a_rhel_premigration_playbook">
<title>Creating a <literal>RHEL premigration</literal> playbook for RHEL/Linux source virtual machines</title>
<simpara>If you are migrating virtual machines running RHEL or other Linux operating system, a <literal>RHEL premigration</literal> playbook ensures that their IP addresses are accessible after migration. The <literal>RHEL premigration</literal> playbook calls the Ansible <literal>ims.rhel_premigration</literal> role (see <link xlink:href="https://galaxy.ansible.com/fdupont_redhat/ims_rhel_pre_migration">https://galaxy.ansible.com/fdupont_redhat/ims_rhel_pre_migration</link> for documentation).</simpara>
<simpara>The <literal>ims.rhel_premigration</literal> role performs the following tasks on the source virtual machines:</simpara>
<itemizedlist>
<listitem>
<simpara>Preserves the static IP address configuration by creating udev rules to associate the virtual machine’s MAC address with its interface name</simpara>
</listitem>
<listitem>
<simpara>(Red Hat Virtualization only) Installs the Red Hat Virtualization guest agent, which enables Red Hat Virtualization to report the IP address of the new virtual machine and to integrate it into the new environment</simpara>
</listitem>
</itemizedlist>
<note>
<simpara>The <literal>ims.rhel_premigration</literal> role assumes that either the <literal>rhel-6-server-rpms</literal> or the <literal>rhel-7-server-rpms</literal> repository is enabled in the source virtual machine when it installs <literal>qemu-guest-agent</literal>. If you have disabled the repository, re-enable it in the RHEL premigration playbook.</simpara>
</note>
<formalpara>
<title><literal>RHEL premigration</literal> playbook example</title>
<para>
<programlisting language="yml" linenumbering="unnumbered">---
- hosts: all
  roles:
    - role: ims.rhel_pre_migration</programlisting>
</para>
</formalpara>
<simpara>You will select this playbook as a premigration playbook service in the <link linkend="Advanced_options_screen">Advanced options screen</link> when you create the migration plan.</simpara>
<simpara>You are ready to create a migration plan. See <xref linkend="Creating_a_migration_plan"/>.</simpara>
</section>
<section xml:id="Adding_ansible_playbooks_to_cloudforms">
<title>Adding Ansible playbooks to CloudForms for premigration and postmigration tasks</title>
<simpara>You can add Ansible playbooks to CloudForms to perform automated premigration and postmigration tasks on specific virtual machines, for example:</simpara>
<itemizedlist>
<listitem>
<simpara>Removing webservers from a load-balancing pool before migration and returning them to the pool after migration</simpara>
</listitem>
<listitem>
<simpara>Running postmigration cleanup tasks, such as <literal>fstrim</literal>, to reduce the space required by virtual machines migrating to OpenStack Platform with Ceph storage (see <xref linkend="Installing_and_configuring_open_stack_platform"/>)</simpara>
</listitem>
</itemizedlist>
<simpara>CloudForms requires a minimum of one Ansible playbook repository, one playbook, and one set of credentials.</simpara>
<orderedlist xml:id="Creating_an_Ansible_service_catalog_item" numeration="arabic">
<title>Procedure</title>
<listitem>
<simpara>Enable the <literal>Embedded Ansible</literal> server role (see <link xlink:href="https://access.redhat.com/documentation/en-us/red_hat_cloudforms/4.7/html/managing_providers/automation_management_providers#enabling-embedded-ansible-server-role">Enabling the Embedded Ansible Server Role</link> in <emphasis>Red Hat CloudForms: Managing Providers</emphasis>).</simpara>
</listitem>
<listitem>
<simpara>Add an Ansible playbook repository (see <link xlink:href="https://access.redhat.com/documentation/en-us/red_hat_cloudforms/4.7/html/managing_providers/automation_management_providers#adding-a-playbook-repository">Adding a Playbook Repository</link> in <emphasis>Red Hat CloudForms: Managing Providers</emphasis>).</simpara>
</listitem>
<listitem>
<simpara>Add the Ansible credentials for your virtual machines (see <link xlink:href="https://access.redhat.com/documentation/en-us/red_hat_cloudforms/4.7/html/managing_providers/automation_management_providers#ansible-credentials">Credentials</link> in <emphasis>Red Hat CloudForms: Managing Providers</emphasis>).</simpara>
</listitem>
<listitem>
<simpara>Add a playbook as an Ansible service catalog item (see <link xlink:href="https://access.redhat.com/documentation/en-us/red_hat_cloudforms/4.7/html-single/provisioning_virtual_machines_and_instances/#create-playbook-service-catalog-item">Creating an Ansible Playbook Service Catalog Item</link> in <emphasis>Red Hat CloudForms: Provisioning Virtual Machines and Instances</emphasis>).</simpara>
</listitem>
</orderedlist>
<simpara>You will select the playbooks and the virtual machines on which they run in the <link linkend="Advanced_options_screen">Advanced Options screen</link> when you create the migration plan.</simpara>
<simpara>You are ready to create a migration plan. See <xref linkend="Creating_a_migration_plan"/>.</simpara>
</section>
</section>
<section xml:id="Creating_a_migration_plan">
<title>Creating a migration plan</title>
<note>
<title>Large migrations</title>
<simpara>A CSV file is optional, but recommended, for large migrations because it is faster than manually selecting virtual machines or setting an OpenStack Platform security group and flavor for each virtual machine. See <xref linkend="Creating_a_csv_file_to_add_virtual_machines_to_the_migration_plan"/>.</simpara>
</note>
<orderedlist numeration="arabic">
<listitem>
<simpara>Click <menuchoice><guimenu>Compute</guimenu> <guisubmenu>Migration</guisubmenu> <guimenuitem>Migration Plans</guimenuitem></menuchoice>.</simpara>
</listitem>
<listitem>
<simpara>Click <emphasis role="strong">Create Migration Plan</emphasis>.</simpara>
</listitem>
<listitem>
<simpara>Perform the following procedures in the <emphasis role="strong">Create Migration Plan</emphasis> wizard:</simpara>
</listitem>
</orderedlist>
<simpara><inlinemediaobject>
<imageobject>
<imagedata fileref="images/Create_Migration_Plan_screen.png"/>
</imageobject>
<textobject><phrase>Create Migration Plan screen</phrase></textobject>
</inlinemediaobject></simpara>
<informaltable frame="all" rowsep="1" colsep="1">
<tgroup cols="2">
<colspec colname="col_1" colwidth="25*"/>
<colspec colname="col_2" colwidth="75*"/>
<thead>
<row>
<entry align="left" valign="top">Screen</entry>
<entry align="left" valign="top">Procedure</entry>
</row>
</thead>
<tbody>
<row>
<entry align="left" valign="top"><simpara><emphasis role="strong">General</emphasis></simpara></entry>
<entry align="left" valign="top"><orderedlist numeration="arabic">
<listitem>
<simpara>Select an infrastructure mapping from the drop-down list.</simpara>
<simpara>If you select an OpenStack Platform mapping, an <emphasis role="strong">Instance Properties</emphasis> screen appears after the <emphasis role="strong">VMs</emphasis> screen.</simpara>
</listitem>
<listitem>
<simpara>Enter the migration plan <emphasis role="strong">Name</emphasis> and (optional) <emphasis role="strong">Description</emphasis>.</simpara>
</listitem>
<listitem>
<simpara>Select a virtual machine discovery method:</simpara>
<itemizedlist>
<listitem>
<simpara><emphasis role="strong">Choose from a list of VMs discovered in the selected infrastructure mapping</emphasis></simpara>
</listitem>
<listitem>
<simpara><emphasis role="strong">Import a CSV file with a list of VMs to be migrated</emphasis>.</simpara>
<simpara>A <link linkend="Creating_a_csv_file_to_add_virtual_machines_to_the_migration_plan">CSV file</link> is required for previously migrated source virtual machines and highly recommended for large migrations.</simpara>
</listitem>
</itemizedlist>
</listitem>
<listitem>
<simpara>Click <emphasis role="strong">Next</emphasis>.</simpara>
</listitem>
</orderedlist></entry>
</row>
<row>
<entry align="left" valign="top"><simpara><emphasis role="strong">VMs</emphasis></simpara></entry>
<entry align="left" valign="top"><orderedlist numeration="arabic">
<listitem>
<simpara>If you selected <emphasis role="strong">Choose from a list of VMs discovered in the selected infrastructure mapping</emphasis>, select the virtual machines for migration. You can search for virtual machines by <emphasis role="strong">VM Name</emphasis>, <emphasis role="strong">Data Center</emphasis>, <emphasis role="strong">Cluster</emphasis>, and <emphasis role="strong">Folder</emphasis>.</simpara>
<simpara>If you selected <emphasis role="strong">Import a CSV file with a list of VMs to be migrated</emphasis>:</simpara>
<orderedlist numeration="loweralpha">
<listitem>
<simpara>Click <emphasis role="strong">Import</emphasis>.</simpara>
</listitem>
<listitem>
<simpara>Browse to the CSV file and click <emphasis role="strong">Open</emphasis>.</simpara>
<simpara>If you try to import an invalid CVS file (for example, virtual machines with a duplicate <literal>Name</literal> field and no <literal>Host</literal>/<literal>Provider</literal> field to distinguish them, or with a duplicate <literal>Name</literal> field and duplicate <literal>Host</literal>/<literal>Provider</literal> fields), the <emphasis role="strong">Create Migration Plan</emphasis> wizard will freeze. This is a <link linkend="Known_issues">known issue</link> and will be addressed in a future release.</simpara>
</listitem>
</orderedlist>
</listitem>
<listitem>
<simpara>Click <emphasis role="strong">Next</emphasis>.</simpara>
</listitem>
</orderedlist>
<simpara>If the <emphasis role="strong">Create Migration Plan</emphasis> wizard cannot discover or import the source virtual machines, see <xref linkend="Migration_plan_errors"/> for possible causes.</simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara><emphasis role="strong">Instance Properties</emphasis></simpara>
<simpara>(OpenStack Platform only)</simpara></entry>
<entry align="left" valign="top"><orderedlist numeration="arabic">
<listitem>
<simpara>Click the pencil icon to edit the network or flavor of each selected virtual machine.</simpara>
<simpara>Flavors that are too small for the virtual machine are marked with an asterisk (<literal>*</literal>). If you have not created flavors for the migration, CloudForms tries to map the source virtual machines to existing flavors.</simpara>
</listitem>
<listitem>
<simpara>Click <emphasis role="strong">Next</emphasis>.</simpara>
</listitem>
</orderedlist></entry>
</row>
<row>
<entry align="left" valign="top"><simpara><emphasis role="strong">Advanced Options</emphasis></simpara></entry>
<entry align="left" valign="top"><orderedlist xml:id="Advanced_options_screen" numeration="arabic">
<listitem>
<simpara>Select a premigration and/or postmigration playbook service from the dropdown lists (see <xref linkend="Adding_ansible_playbooks_to_cloudforms"/> for details).</simpara>
</listitem>
<listitem>
<simpara>Select the virtual machines on which to run the playbook services.</simpara>
</listitem>
<listitem>
<simpara>Click <emphasis role="strong">Next</emphasis>.</simpara>
</listitem>
</orderedlist></entry>
</row>
<row>
<entry align="left" valign="top"><simpara><emphasis role="strong">Schedule</emphasis></simpara></entry>
<entry align="left" valign="top"><orderedlist numeration="arabic">
<listitem>
<simpara>Select a schedule option:</simpara>
<itemizedlist>
<listitem>
<simpara><emphasis role="strong">Save migration plan to run later</emphasis></simpara>
<simpara>The migration plan is saved in <emphasis role="strong">Migration Plans Not Started</emphasis> and will not run unless you schedule it (see <xref linkend="Scheduling_a_saved_migration_plan"/>) or click <emphasis role="strong">Migrate</emphasis> to run the scheduled migration plan immediately.</simpara>
</listitem>
<listitem>
<simpara><emphasis role="strong">Start migration immediately</emphasis></simpara>
<simpara>The migration plan may take some time to complete. Progress bars indicate the amount of transferred data, the number of migrated virtual machines, and the elapsed time. See <xref linkend="Viewing_migration_plan_progress"/> for details.</simpara>
<simpara>Optionally, you can <link linkend="Canceling_a_migration_plan">cancel a migration plan in progress</link>.</simpara>
</listitem>
</itemizedlist>
</listitem>
<listitem>
<simpara>Click <emphasis role="strong">Create</emphasis>.</simpara>
</listitem>
</orderedlist></entry>
</row>
<row>
<entry align="left" valign="top"><simpara><emphasis role="strong">Results</emphasis></simpara></entry>
<entry align="left" valign="top"><simpara>Click <emphasis role="strong">Close</emphasis>.</simpara></entry>
</row>
</tbody>
</tgroup>
</informaltable>
<simpara>When the migration plan has finished, click <emphasis role="strong">Migration Plans Complete</emphasis> to view the status of the migration plan. The completed migration plan shows the status of the migrated virtual machines. If there are errors, see <xref linkend="Troubleshooting"/>.</simpara>
<simpara>In the migration plans list, you can click the <emphasis role="strong">More Actions</emphasis> icon (<inlinemediaobject>
<imageobject>
<imagedata fileref="images/More_actions_icon.png"/>
</imageobject>
<textobject><phrase>7</phrase></textobject>
</inlinemediaobject>) to archive, edit, or delete a migration plan.</simpara>
<orderedlist xml:id="Scheduling_a_saved_migration_plan" numeration="arabic">
<title>Scheduling a saved migration plan</title>
<listitem>
<simpara>Click <emphasis role="strong">Migration Plans Not Started</emphasis>.</simpara>
</listitem>
<listitem>
<simpara>Click the <emphasis role="strong">Schedule</emphasis> button of a migration plan.</simpara>
</listitem>
<listitem>
<simpara>In the <emphasis role="strong">Schedule Migration Plan</emphasis> window, select a date and time and click <emphasis role="strong">Schedule</emphasis>. The plan’s status is <emphasis role="strong">Migration Scheduled</emphasis> with the date and time.</simpara>
</listitem>
</orderedlist>
<orderedlist xml:id="Viewing_migration_plan_progress" numeration="arabic">
<title>Viewing a migration plan in progress</title>
<listitem>
<simpara>Click <emphasis role="strong">Migration Plans in Progress</emphasis>.</simpara>
</listitem>
<listitem>
<simpara>Click a migration plan name to view its details, including the status of the migrating virtual machines.</simpara>
</listitem>
</orderedlist>
<note>
<simpara>The counter in <menuchoice><guimenu>Compute</guimenu> <guisubmenu>Migration</guisubmenu> <guimenuitem>Migration Plans</guimenuitem></menuchoice> may be a few seconds ahead of the counter in the migration plan details view. This is because the <emphasis role="strong">Migration Plans</emphasis> counter displays the total time for running the migration plan, while the details counter displays the time for migrating the virtual machines.</simpara>
</note>
<orderedlist xml:id="Canceling_a_migration_plan" numeration="arabic">
<title>Canceling a migration plan in progress</title>
<listitem>
<simpara>Click <emphasis role="strong">Migration Plans in Progress</emphasis>.</simpara>
</listitem>
<listitem>
<simpara>Select a migration plan and click <emphasis role="strong">Cancel Migration</emphasis>.</simpara>
</listitem>
<listitem>
<simpara>Click <emphasis role="strong">Cancel Migrations</emphasis> to confirm the cancellation. The canceled migration appears in <emphasis role="strong">Migration Plans Complete</emphasis> with a red <literal>x</literal> indicating that the plan did not complete successfully.</simpara>
</listitem>
</orderedlist>
<orderedlist xml:id="Retrying_a_failed_migration_plan" numeration="arabic">
<title>Retrying a migration plan</title>
<listitem>
<simpara>Delete newly created target virtual machines or instances, if any, to avoid name conflicts with the migrating VMware virtual machines.</simpara>
</listitem>
<listitem>
<simpara>Delete newly created disks in the target datastore to free up space.</simpara>
</listitem>
<listitem>
<simpara>OpenStack Platform only: Delete newly created network ports of failed instances.</simpara>
</listitem>
<listitem>
<simpara>Click <menuchoice><guimenu>Compute</guimenu> <guisubmenu>Migration</guisubmenu> <guimenuitem>Migration Plans</guimenuitem></menuchoice>.</simpara>
</listitem>
<listitem>
<simpara>Click <emphasis role="strong">Migration Plans Complete</emphasis>.</simpara>
</listitem>
<listitem>
<simpara>Click the <emphasis role="strong">Retry</emphasis> button beside the failed migration plan.</simpara>
</listitem>
</orderedlist>
</section>
</section>
<section xml:id="Changing_the_maximum_number_of_concurrent_migrations">
<title>Changing the maximum number of concurrent migrations</title>
<simpara>You can change the maximum number of concurrent migrations for conversion hosts or providers to control the impact of the migration process on your infrastructure.</simpara>
<warning>
<simpara>For VDDK, the maximum concurrent migrations per conversion host should not be greater than <literal>20</literal>. Otherwise, network overload will cause the migration to fail.</simpara>
</warning>
<simpara>The provider setting has priority over the conversion host setting. For example, if the maximum number of concurrent migrations for a provider is <literal>20</literal> and for five conversion hosts, <literal>3</literal>, the maximum number of concurrent migrations is <literal>20</literal>, not <literal>15</literal> (<literal>5</literal> conversion hosts <literal>x</literal> <literal>3</literal> concurrent migrations).</simpara>
<simpara>An increase in the maximum number of concurrent migrations affects all migration plans immediately. Virtual machines that are queued to migrate will migrate in greater numbers.</simpara>
<simpara>A decrease maximum number of concurrent migrations affects only future migration plans. Migration plans that are in progress will use the limit that was set when the plan was created.</simpara>
<variablelist>
<varlistentry>
<term>Changing the maximum number of concurrent migrations for all conversion hosts</term>
<listitem>
<simpara>In CloudForms, click <menuchoice><guimenu>Compute</guimenu> <guisubmenu>Migration</guisubmenu> <guimenuitem>Migration Settings</guimenuitem></menuchoice> and select the new limit.</simpara>
</listitem>
</varlistentry>
</variablelist>
<note>
<simpara>The following commands are performed on the command line of the CloudForms machine.</simpara>
</note>
<variablelist>
<varlistentry>
<term>Changing the maximum number of concurrent migrations for a single conversion host</term>
<listitem>
<screen># vmdb
# rails console
irb(main):001:0&gt; $evm = MiqAeMethodService::MiqAeService.new(MiqAeEngine::MiqAeWorkspaceRuntime.new)
irb(main):002:0&gt; $evm.vmdb(:host).find_by(:name =&gt; "<emphasis>host1.example.com</emphasis>").custom_set("Max Transformation Runners", <emphasis>20</emphasis>)</screen>
</listitem>
</varlistentry>
<varlistentry>
<term>Changing the maximum number of concurrent migrations for a provider</term>
<listitem>
<screen># vmdb
# rails console
irb(main):001:0&gt; $evm = MiqAeMethodService::MiqAeService.new(MiqAeEngine::MiqAeWorkspaceRuntime.new)
irb(main):002:0&gt; $evm.vmdb(:ext_management_system).find_by(:name =&gt; "<emphasis>RHV</emphasis>").custom_set("Max Transformation Runners", <emphasis>30</emphasis>)</screen>
</listitem>
</varlistentry>
<varlistentry>
<term>Getting the maximum number of concurrent migrations for a provider</term>
<listitem>
<screen># vmdb
# rails console
irb(main):001:0&gt; $evm = MiqAeMethodService::MiqAeService.new(MiqAeEngine::MiqAeWorkspaceRuntime.new)
irb(main):002:0&gt; $evm.vmdb(:ext_management_system).find_by(:name =&gt; "<emphasis>OpenStack</emphasis>").custom_get("Max Transformation Runners")</screen>
</listitem>
</varlistentry>
</variablelist>
</section>
</chapter>
<chapter xml:id="Troubleshooting">
<title>Troubleshooting</title>
<simpara>To identify errors, check the migration logs (<xref linkend="Migration_logs"/>).</simpara>
<simpara>You can check these common issues and mistakes:</simpara>
<itemizedlist>
<listitem>
<simpara><link linkend="Infrastructure_mapping_errors">Infrastructure mapping errors</link></simpara>
</listitem>
<listitem>
<simpara><link linkend="Migration_plan_errors">Migration plan errors</link></simpara>
</listitem>
<listitem>
<simpara><link linkend="IP_address_errors">Postmigration virtual machine IP address errors</link></simpara>
</listitem>
<listitem>
<simpara>Environment configuration errors:</simpara>
<itemizedlist>
<listitem>
<simpara><link linkend="VMware_environment_errors">VMware</link></simpara>
</listitem>
<listitem>
<simpara><link linkend="RHV_VM_migration_failure">Red Hat Virtualization</link></simpara>
</listitem>
<listitem>
<simpara><link linkend="OSP_VM_migration_failure">OpenStack Platform</link></simpara>
</listitem>
</itemizedlist>
</listitem>
</itemizedlist>
<simpara><xref linkend="Known_issues"/> provides information about issues that will be addressed in a future release.</simpara>
<section xml:id="Migration_logs">
<title>Migration logs</title>
<simpara>The conversion host logs and the CloudForms migration log can help with troubleshooting.</simpara>
<formalpara>
<title>Conversion host logs</title>
<para>When disk migration starts, two logs are created in the conversion host:</para>
</formalpara>
<itemizedlist>
<listitem>
<simpara><literal>virt-v2v</literal>: Debug output from <literal>virt-v2v</literal> itself. This log tracks the core of the virtual machine migration process, including <literal>libguestfs</literal> traces and disk migration details.</simpara>
</listitem>
<listitem>
<simpara><literal>virt-v2v-wrapper</literal>: Log of the daemonizing wrapper for <literal>virt-v2v</literal>. This log traces the orchestration of the virtual machine conversion on the conversion host, including disk migration percentages and <literal>virt-v2v</literal> error reporting.</simpara>
</listitem>
</itemizedlist>
<simpara>For more information about the functions of <literal>virt-v2v</literal> and <literal>virt-v2v-wrapper</literal>, see the migration workflows:</simpara>
<itemizedlist>
<listitem>
<simpara><xref linkend="Vmware_to_rhv_migration_workflow"/></simpara>
</listitem>
<listitem>
<simpara><xref linkend="Vmware_to_osp_migration_workflow"/></simpara>
</listitem>
</itemizedlist>
<important>
<simpara>If you need to open a <link xlink:href="https://access.redhat.com/support/cases/#/case/new">Red Hat Support call</link>, you will be required to submit both the migration (<literal>virt-v2v</literal>) log and <literal>virt-v2v-wrapper</literal> log for analysis.</simpara>
</important>
<variablelist>
<varlistentry>
<term>Accessing the <literal>virt-v2v</literal> and <literal>virt-v2v-wrapper</literal> logs on the conversion host</term>
<listitem>
<orderedlist numeration="arabic">
<listitem>
<simpara>Log in to the conversion host using SSH. If you have multiple conversion hosts, you can view the name of a virtual machine’s conversion host by clicking the information icon (<inlinemediaobject>
<imageobject>
<imagedata fileref="images/Info_icon.png"/>
</imageobject>
<textobject><phrase>20</phrase></textobject>
</inlinemediaobject>) of the virtual machine in the migration plan’s details view.</simpara>
</listitem>
<listitem>
<simpara>Go to <literal>/var/log/vdsm/import/</literal> to access the logs for each migration:</simpara>
<itemizedlist>
<listitem>
<simpara><literal>virt-v2v</literal> log: <literal>v2v-import-<emphasis>date</emphasis>-<emphasis>log_number</emphasis>.log</literal></simpara>
</listitem>
<listitem>
<simpara><literal>virt-v2v-wrapper</literal> log: <literal>v2v-import-<emphasis>date</emphasis>-<emphasis>log_number</emphasis>-wrapper.log</literal></simpara>
</listitem>
</itemizedlist>
</listitem>
</orderedlist>
</listitem>
</varlistentry>
<varlistentry>
<term>Downloading the <literal>virt-v2v</literal> log in CloudForms</term>
<listitem>
<orderedlist numeration="arabic">
<listitem>
<simpara>Click <menuchoice><guimenu>Compute</guimenu> <guisubmenu><emphasis role="strong">Migration</emphasis></guisubmenu> <guimenuitem>Migration Plans</guimenuitem></menuchoice>.</simpara>
</listitem>
<listitem>
<simpara>Click a completed migration plan to view its details.</simpara>
</listitem>
<listitem>
<simpara>Click <menuchoice><guimenu>Download Log</guimenu> <guimenuitem>Migration Log</guimenuitem></menuchoice>.</simpara>
</listitem>
</orderedlist>
</listitem>
</varlistentry>
</variablelist>
<formalpara xml:id="CloudForms_log">
<title>CloudForms migration log</title>
<para>This log traces the orchestration of the virtual machine migration in CloudForms.</para>
</formalpara>
<variablelist>
<varlistentry>
<term>Accessing the CloudForms migration log</term>
<listitem>
<orderedlist numeration="arabic">
<listitem>
<simpara>Log in to the CloudForms machine using SSH.</simpara>
</listitem>
<listitem>
<simpara>View the migration log, <literal>/var/www/miq/vmdb/log/automation.log</literal>.</simpara>
</listitem>
</orderedlist>
</listitem>
</varlistentry>
</variablelist>
</section>
<section xml:id="Infrastructure_mapping_errors">
<title>Infrastructure mapping errors</title>
<itemizedlist xml:id="Infrastructure_mapping_missing_resources">
<listitem>
<simpara><literal>Networks missing</literal>, <literal>Datastores missing</literal>, and <literal>Clusters missing</literal> error messages: If you create an infrastructure mapping and change a provider or refresh the RHV hosts, the provider’s object IDs change. Delete the infrastructure mapping and create a new one.</simpara>
</listitem>
</itemizedlist>
<itemizedlist xml:id="OpenStack_storage_not_detected">
<listitem>
<simpara>OpenStack Platform volume type not detected: Check that you have set at least one volume type. See <link xlink:href="https://access.redhat.com/documentation/en-us/red_hat_openstack_platform/14/html-single/storage_guide/index#section-volumes-advanced-vol-type">Group Volume Settings with Volume Types</link> in the <emphasis>Red Hat OpenStack Platform Storage Guide</emphasis> for the storage.</simpara>
</listitem>
</itemizedlist>
</section>
<section xml:id="Migration_plan_errors">
<title>Migration plan errors</title>
<itemizedlist xml:id="Virtual_machines_cannot_be_discovered">
<listitem>
<simpara>If the virtual machines are being migrated for the first time and are not discovered by the migration plan, check the source datastores and networks in the infrastructure mapping.</simpara>
</listitem>
<listitem>
<simpara>If the virtual machines have been migrated in the past, they cannot be discovered by the migration plan. Use a <link linkend="Creating_a_csv_file_to_add_virtual_machines_to_the_migration_plan">CSV file</link> to add the virtual machines to the migration plan.</simpara>
</listitem>
</itemizedlist>
<itemizedlist xml:id="Virtual_machines_cannot_be_added_with_CSV_file">
<listitem>
<simpara>If the virtual machines cannot be added to the migration plan with a CSV file, check the   <link linkend="Creating_a_csv_file_to_add_virtual_machines_to_the_migration_plan">CSV file format and fields</link>. Create a new migration plan with the updated CSV file.</simpara>
</listitem>
<listitem>
<simpara><emphasis role="strong">Create Migration Plan</emphasis> wizard hang while importing CSV file. This error is caused by an invalid CVS file (for example, virtual machines with a duplicate <literal>Name</literal> field and no <literal>Host</literal>/<literal>Provider</literal> field to distinguish them, or with a duplicate <literal>Name</literal> field and duplicate <literal>Host</literal>/<literal>Provider</literal> fields). You must reload the web page. This is a <link linkend="Known_issues">known issue</link> and will be addressed in a future release.</simpara>
</listitem>
<listitem>
<simpara><literal>Denied State</literal> error (IMS 1.1). If a migration plan fails immediately and the migration plan displays a <literal>Denied State</literal> error message, check that you have created and configured the conversion hosts correctly. <link linkend="Canceling_a_migration_plan">Cancel the migration plan</link> and <link linkend="Retrying_a_failed_migration_plan">retry it</link>.</simpara>
</listitem>
<listitem>
<simpara>If you have not configured conversion hosts, the following error appears after running the migration plan (IMS 1.2): <literal>Unable to migrate VMs because no conversion host was configured at the time of the attempted migration. See the product documentation for information on configuring conversion hosts.</literal> You can create and save a migration plan whose infrastructure mapping does not contain conversion hosts, but you cannot run the migration plan without conversion hosts.</simpara>
</listitem>
</itemizedlist>
</section>
<section xml:id="Virtual_machine_migration_errors">
<title>Virtual machine migration errors</title>
<section xml:id="IP_address_errors">
<title>Postmigration virtual machine IP address errors</title>
<itemizedlist xml:id="Migrated_RHEL_IP_address_not_accessible">
<listitem>
<simpara>If the IP address of a migrated RHEL (or other Linux-based operating system) virtual machine is not accessible, create a <link linkend="Creating_a_rhel_premigration_playbook"><literal>RHEL premigration</literal> playbook</link> and add it to the <link linkend="Advanced_options_screen">migration plan</link>.</simpara>
</listitem>
</itemizedlist>
<itemizedlist xml:id="Migrated_VM_missing_IP">
<listitem>
<simpara>If a migrated virtual machine does not have an IP address:</simpara>
<itemizedlist>
<listitem>
<simpara>Check that VMware Tools is installed on the source virtual machine.</simpara>
</listitem>
<listitem>
<simpara>OpenStack Platform: Check the source virtual machine for an interface configuration file mapped to a non-existent interface (for example, <literal>/etc/sysconfig/network-scripts/ifcfg-eth1</literal> exists, but <literal>eth1</literal> interface does not). Log example:</simpara>
<screen>CalledProcessError: Command '['openstack', u'--os-username=admin', u'--os-identity-api-version=3', u'--os-user-domain-name=default', u'--os-auth-url=http://<emphasis>osp.example.com</emphasis>:5000/v3', u'--os-project-name=admin', u'--os-password=****<emphasis role="strong">*</emphasis>*<emphasis>, u</emphasis>--os-project-id=0123456789abcdef0123456789abcdef', 'port', 'create', '--format', 'json', '--network', u'01234567-89ab-cdef-0123-456789abcdef', '--mac-address', u'00:50:56:01:23:45', '--enable', u'port_0', '--fixed-ip', '<emphasis role="strong">ip-address=None</emphasis>'"]' returned non-zero exit status 1
<emphasis>date</emphasis> <emphasis>time</emphasis>:ERROR: Command output:
BadRequestException: Unknown error</screen>
</listitem>
</itemizedlist>
</listitem>
</itemizedlist>
</section>
<section xml:id="VMware_environment_errors">
<title>VMware environment errors</title>
<simpara>A source virtual machine cannot migrate if it has any of the following conditions:</simpara>
<itemizedlist>
<listitem>
<simpara>Mounted ISO/CDROM disk</simpara>
</listitem>
<listitem>
<simpara>Encrypted disk</simpara>
</listitem>
<listitem>
<simpara>Invalid name (containing spaces or special characters)</simpara>
</listitem>
</itemizedlist>
<simpara>If you are using SSH transformation, see <xref linkend="Configuring_the_vmware_hypervisors_for_ssh_transformation"/>.</simpara>
</section>
<section xml:id="Target_environment_errors">
<title>Target environment errors</title>
<simpara xml:id="RHV_VM_migration_failure"><emphasis role="strong">Red Hat Virtualization</emphasis></simpara>
<itemizedlist xml:id="RHV_name_conflict">
<listitem>
<simpara>Name conflict: VMware virtual machine has the same name as a RHV virtual machine.</simpara>
</listitem>
<listitem>
<simpara>MAC address conflict: VMware virtual machine has the same MAC address as a RHV virtual machine in a MAC address pool.</simpara>
</listitem>
<listitem>
<simpara>SSH transformation failure:</simpara>
<itemizedlist>
<listitem>
<simpara>If you are using SSSD with single sign-on, <link linkend="Reinstalling_ipa_client">reinstall <literal>ipa-client</literal></link> without the OpenSSH client.</simpara>
</listitem>
<listitem>
<simpara>Check that SSH transformation was correctly configured. See <xref linkend="Configuring_the_vmware_hypervisors_for_ssh_transformation"/> and <xref linkend="Configuring_the_conversion_hosts"/>.</simpara>
</listitem>
</itemizedlist>
</listitem>
</itemizedlist>
<simpara xml:id="OSP_VM_migration_failure"><emphasis role="strong">OpenStack Platform</emphasis></simpara>
<itemizedlist xml:id="OSP_VM_powered_off">
<listitem>
<simpara>Virtual machine powered off: The virtual machine must be powered on at the time of migration.</simpara>
</listitem>
<listitem>
<simpara>SSH transformation failure: Check that SSH transformation was correctly configured. See <xref linkend="Configuring_the_vmware_hypervisors_for_ssh_transformation"/> and <xref linkend="Configuring_the_conversion_hosts"/>.</simpara>
</listitem>
</itemizedlist>
<itemizedlist xml:id="OSP_not_authorized">
<listitem>
<simpara><literal>disallowed by policy</literal> error: The OpenStack Platform <literal>admin</literal> user in CloudForms does not have <literal>admin</literal> role privileges within the target project. Add the <literal>admin</literal> user as <literal>member</literal> and <literal>admin</literal> to your target project (see <link xlink:href="https://access.redhat.com/documentation/en-us/red_hat_openstack_platform/14/html-single/users_and_identity_management_guide/#edit_a_project">Edit a Project</link> in the <emphasis>Red Hat OpenStack Platform Users and Identity Management Guide</emphasis>). Log example:</simpara>
<screen>ERROR: Command exited with non-zero return code 1, output: HttpException: 403: Client Error for url: https://<emphasis>FQDN</emphasis>:13696/v2.0/ports, {"NeutronError": {"message": "((rule:create_port and rule:create_port:mac_address) and rule:create_port:fixed_ips) is disallowed by policy", "type": "PolicyNotAuthorized", "detail": ""}}</screen>
</listitem>
</itemizedlist>
</section>
</section>
<section xml:id="Known_issues">
<title>Known Issues</title>
<note>
<simpara>To obtain critical updates for the conversion hosts:</simpara>
<itemizedlist>
<listitem>
<simpara>Red Hat Virtualization: Run <literal>yum update</literal> on the conversion hosts.</simpara>
</listitem>
<listitem>
<simpara>OpenStack Platform: Download the latest conversion host appliance and re-deploy the conversion hosts (see <xref linkend="Deploying_osp_conversion_hosts"/>).</simpara>
</listitem>
</itemizedlist>
</note>
<simpara>The following issues will be addressed in a future release:</simpara>
<itemizedlist>
<listitem>
<simpara>Canceling a migration does not stop the creation of volumes, instances, and network ports (OpenStack Platform), or virtual machines (Red Hat Virtualization). <link xlink:href="https://bugzilla.redhat.com/show_bug.cgi?id=1666799">https://bugzilla.redhat.com/show_bug.cgi?id=1666799</link></simpara>
</listitem>
<listitem>
<simpara>Migrating over SSH and VDDK transformation method with names containing international chars or spaces fails to migrate. <link xlink:href="https://bugzilla.redhat.com/show_bug.cgi?id=1678385">https://bugzilla.redhat.com/show_bug.cgi?id=1678385</link></simpara>
</listitem>
<listitem>
<simpara>"Maximum concurrent migrations per conversion host" in UI not working. <link xlink:href="https://bugzilla.redhat.com/show_bug.cgi?id=1698761">https://bugzilla.redhat.com/show_bug.cgi?id=1698761</link></simpara>
</listitem>
<listitem>
<simpara>Migration plan CSV import validation not working if file contains empty/archived/orphan/invalid VM name. <link xlink:href="https://bugzilla.redhat.com/show_bug.cgi?id=1699343">https://bugzilla.redhat.com/show_bug.cgi?id=1699343</link></simpara>
</listitem>
<listitem>
<simpara>Red Hat Virtualization:</simpara>
<itemizedlist>
<listitem>
<simpara>Refreshing the hosts causes the network(s) and datastore to disappear from infrastructure mappings. <link xlink:href="https://bugzilla.redhat.com/show_bug.cgi?id=1669176">https://bugzilla.redhat.com/show_bug.cgi?id=1669176</link></simpara>
</listitem>
</itemizedlist>
</listitem>
<listitem>
<simpara>OpenStack Platform:</simpara>
<itemizedlist>
<listitem>
<simpara>Instance is not created after disk conversion. <link xlink:href="https://bugzilla.redhat.com/show_bug.cgi?id=1668049">https://bugzilla.redhat.com/show_bug.cgi?id=1668049</link></simpara>
</listitem>
<listitem>
<simpara>Names of virtual machines that were migrated using SSH transformation change during migration. <link xlink:href="https://bugzilla.redhat.com/show_bug.cgi?id=1669133">https://bugzilla.redhat.com/show_bug.cgi?id=1669133</link></simpara>
</listitem>
</itemizedlist>
</listitem>
</itemizedlist>
</section>
</chapter>
</book>