[id='Troubleshooting']
= Troubleshooting

If errors occur for reasons unrelated to the infrastructure mapping or migration plan, you can xref:Retrying_a_Migration_Plan[retry the migration plan].

If the cause of the failed migration is not clear, see xref:Logs[] and xref:Common_issues_and_mistakes[].

[[Retrying_a_Migration_Plan]]
== Retrying a migration plan

If one or more virtual machines in a migration plan fails to migrate, the migration plan's status is `Failed`. After resolving the issue that caused the migration failure, you can retry the migration plan:

. Click the migration plan to go to the details page to identify the virtual machines that failed to migrate.
. If the migration failed while virtual machines were being converted:
.. Delete newly created target virtual machines to avoid name conflicts with source virtual machines.
.. Delete newly created disks in the target datastore to free up space.
. Click menu:Compute[Migration], select `Failed Migrations`, select the failed migration plan, and click `Retry`.

[[Logs]]
== Logs

If a migration plan fails and you are not sure of the cause, check the following logs:

* CloudForms migration logs: `/var/www/miq/vmdb/log/`
* RHV conversion host logs: `/var/log/vdsm/import/`
* OpenStack conversion appliance logs: `/var/log/virt-v2v/`
* Virtual machine migration log: Click menu:Compute[Migrate], click the migration plan name, and click `Download Log`.
+
.Migrated virtual machine logs
image:Migrated_VM_details.png[]

[[Common_issues_and_mistakes]]
== Common issues and mistakes

[[Infrastructure_mapping_missing_resources]]
Infrastructure mapping is missing datastores or clusters::
If you create an infrastructure mapping and subsequently add or remove providers or provider objects, the infrastructure mapping displays *Datastores missing* or *Clusters missing* error messages because the object IDs of the providers and their objects have changed. You must delete the infrastructure mapping and re-create it.

[[Infrastructure_mapping_missing_networks]]
Infrastructure mapping is missing networks::
If the infrastructure mapping displays a *Networks missing* error message, you must link:https://access.redhat.com/documentation/en-us/red_hat_cloudforms/4.6/html-single/managing_providers/#authenticating_rhv_hosts[authenticate the RHV conversion hosts] and create a new infrastructure mapping.
+
image:Mapping_missing_network.png[]

Migration plan does not discover virtual machines::
If you are migrating previously migrated virtual machines, the migration plan cannot discover them because they are marked in the CloudForms VMDB as `migrated`. You must xref:Remigrating_Virtual_Machines[remigrate the virtual machines].

Incorrect attributes in the virtual machine CSV import file::
Correct the xref:CSV_file[CSV file], create a new migration plan, import the updated CSV file, and run the migration plan.

Migration fails immediately (`Denied State`)::
If a migration fails immediately and a *Denied State* error message appears in *Migration Plans Complete*, this indicates that a conversion host was not configured. Check that xref:Creating_conversion_hosts[conversion hosts are configured] and that the RHV conversion host link:https://access.redhat.com/documentation/en-us/red_hat_cloudforms/4.6/html-single/managing_providers/#authenticating_rhv_hosts[credentials] have been added to CloudForms. When the cause has been resolved, cancel the migration plan and xref:Retrying_a_Migration_Plan[retry] it.

Migration fails during virtual machine conversion::
Check the xref:Logs[conversion logs] for the virtual machines that failed to migrate. When the cause of the failed migration has been resolved, you can xref:Retrying_a_Migration_Plan[retry the migration plan]. Check that the source virtual machines do not have mounted disks.
+
Red Hat Virtualization: Check that the source virtual machine names do not contain spaces or special characters or duplicate existing virtual machine names in the target environment.
+
OpenStack Platform: Check that the source virtual machines are powered on and that VMware Tools has been installed.

[[SSH_transformation_fails]]
SSH transformation fails::
If you are using SSSD with single sign-on for RHV, SSH fails for the `vdsm` account.
+
Reinstall `ipa-client` without configuring the OpenSSH client:
+
[options="nowrap" subs="+quotes,verbatim"]
----
# ipa-client-install --uninstall
# ipa-client-install --no-ssh
----
+
Changing the configuration file is not recommended because it is restored during upgrades. See link:https://bugzilla.redhat.com/show_bug.cgi?id=1544379[BZ#1544379] for details.
