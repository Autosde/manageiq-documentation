[id='Creating_and_running_a_migration_plan']
= Creating and running a migration plan

The infrastructure migration involves the following key tasks:

. xref:Pre_migration_tasks[Pre-migration tasks]:

* If you are migrating a large number of virtual machines or remigrating virtual machines, you must create a xref:CSV_file[CSV file] to import the virtual machines into the migration plan.

* If you are using Ansible to automate pre- and post-migration tasks, you must set up the xref:Setting_up_an_ansible_environment[Ansible environment].

* If you are migrating RHEL virtual machines, you must set up the xref:Setting_up_an_ansible_environment[Ansible environment] and configure the xref:Rhel_premigration_playbook[RHEL pre-migration playbook].

. xref:Creating_migration_plan[Creating the migration plan]

. xref:Running_migration_plan[Running the migration plan] immediately or scheduling it to run in the future

You can xref:Canceling_a_migration_plan[cancel] a migration plan.

include::proc_Premigration_tasks.adoc[leveloffset=+1]

[[Creating_migration_plan]]
== Creating a migration plan

. Click menu:Compute[Migration > Migration Plans].
+
image:Migration_overview_screen.png[]

. Click *Create Migration Plan*.

. In the *General* screen, select the infrastructure mapping from the drop-down list. If you select an OpenStack Platform infrastructure mapping, the *Migration Plan Wizard* displays an additional screen, *Instance Properties*, after the *VM* screen.

. Enter the name of your migration plan and a description (optional).

. Discover the source virtual machines:

* If you are migrating a small number of virtual machines, select *Choose from a list of VMs discovered in the selected infrastructure mapping* and click *Next*.
+
.Discovered virtual machines
image:Discover_VMs.png[]

* If you are importing a CSV file:

.. (Optional) You can validate your infrastructure mapping. Select *Choose from a list of VMs discovered in the selected infrastructure mapping* and click *Next*. If your virtual machines appear in the list, the infrastructure mapping is correct. Click *Back*.
.. Select *Import a CSV file with a list of VMs to be migrated* and click *Next*.
.. Click *Import*, browse to the CSV file, and click *Open*.

* If you cannot import or discover the source virtual machines, see xref:Migration_plan_errors[Migration plan errors].

. In the *VM* screen, select the virtual machines to migrate and click *Next*.

. OpenStack Platform only: In the *Instance Properties* screen, click the pencil icon to edit the network or flavor of each selected virtual machine.
+
[NOTE]
====
If a flavor is too small for the source virtual machine, it is marked with an asterisk (`*`).
====
+
When you have finished editing the virtual machines, click *Next*.

. [[Automating_pre_and_post_migration_tasks_with_ansible]]In the *Advanced Options* screen, you can select pre- and post-migration playbook services, which you have already created, and the virtual machines on which they should run. See xref:Setting_up_an_ansible_environment[Setting up an Ansible environment for automated tasks].
+
[[Advanced_options_screen]]
.Advanced options
image:Advanced_Options.png[]
+
Click *Next*.

. In the *Schedule* screen, select *Save migration plan to run later* or *Start Migration Immediately* and click *Create*. The status of the migration plan is displayed in the *Results* screen:
+
* If you select *Save migration plan to run later*, the migration plan is saved in *Migration Plans Not Started*.[[Running_migration_plan]]
+
To schedule the migration plan, click the *Schedule* button, select a date and time, and click *Schedule*. The plan's status is *Migration Scheduled* with the date and time.
+
[NOTE]
====
To run a scheduled plan immediately, click *Migrate*.

To edit or delete a schedule or plan, click the *More Actions* icon.
====

* If you select *Start Migration Immediately*, the migration plan runs immediately.
+
The migration plan may take some time to complete. The migration plan displays progress bars showing the amount of data being transferred, the number of virtual machines being migrated, and the elapsed time.
+
To view the migration progress of individual virtual machines, click *Migration Plans in Progress* and click the migration plan name to display the migration plan details.
+
[NOTE]
====
The counter displaying the migration plan progress in menu:Compute[Migration > Migration Plans] may be a few seconds ahead of the counter that appears in the migration plan details. This is because the migration plans counter displays the total time for running a migration plan, while the migration plan details counter displays the time for migrating the virtual machines.
====

. When the migration plan has finished, click *Migration Plans Complete* to view the status of the migration plan. The completed migration plan shows successfully migrated virtual machines.
+
A `Denied State` error indicates a problem with the conversion hosts (see xref:Denied_state_error[Denied state error] for more information).
+
If a virtual machine fails to migrate, see xref:Virtual_machine_migration_failure[Virtual machine migration failure].

include::proc_Canceling_a_migration_plan.adoc[leveloffset=+1]
