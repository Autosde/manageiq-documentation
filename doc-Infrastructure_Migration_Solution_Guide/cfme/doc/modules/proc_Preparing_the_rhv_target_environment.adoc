// Used in module: assembly_Preparing_the_environment_for_migration.adoc
[id="Preparing_the_rhv_target_environment"]
= Preparing the Red Hat Virtualization environment

.Procedure

include::ref_Software_compatibility_requirements.adoc[]
* Set the BIOS settings of the physical hosts for optimal performance (rather than power-saving), according to the vendor's recommendations.
* Disable the C1E halt state, if applicable.

.Configuring Red Hat Virtualization

. Install Red Hat Virtualization Manager 4.3 on the Manager machine (see link:https://access.redhat.com/documentation/en-us/red_hat_virtualization/4.3/html-single/installation_guide/#part-Installing_the_Red_Hat_Virtualization_Manager[Installing the Red Hat Virtualization Manager] in the _Red Hat Virtualization Installation Guide_).

. Install Red Hat Virtualization Host 4.3 (see link:https://access.redhat.com/documentation/en-us/red_hat_virtualization/4.3/html-single/installation_guide/#Installing_RHVH[Installing Red Hat Virtualization Host]) or Red Hat Enterprise Linux 7.6 (see link:https://access.redhat.com/documentation/en-us/red_hat_virtualization/4.3/html-single/installation_guide/#Red_Hat_Enterprise_Linux_Hosts[Installing Red Hat Enterprise Linux Hosts] in the _Red Hat Virtualization Installation Guide_) on the host machines.
+
Some of these hosts will be deployed as conversion hosts. The number of conversion hosts depends on your migration size and infrastructure capabilities. See xref:Deciding_how_many_conversion_hosts_to_create[] for details.

. Enable the following ports in the conversion host network (see https://access.redhat.com/articles/417343[]):
* 22 - SSH
* 443 - CloudForms, Red Hat Virtualization Manager, and VDDK
* 902 - CloudForms to VMware
* 5480 - `virt-v2v` to vCenter

. Create and attach data and ISO storage domains to the data center, ensuring that the data domain has sufficient space for the migrated virtual machines (see link:https://access.redhat.com/documentation/en-us/red_hat_virtualization/4.3/html-single/administration_guide/#chap-Storage[Storage] in the _Red Hat Virtualization Administration Guide_).
+
[NOTE]
====
IMS only supports shared storage, such as NFS, iSCSI, or FCP. Local storage is not supported.
====

. Upload the VirtIO and Guest Tool image files to the ISO storage domain (see link:https://access.redhat.com/documentation/en-us/red_hat_virtualization/4.3/html-single/administration_guide/#Uploading_the_VirtIO_and_Guest_Tool_Image_Files_to_an_ISO_Storage_Domain[Uploading the VirtIO and Guest Tool Image Files to an ISO Storage Domain] in the _Red Hat Virtualization Administration Guide_). The VirtIO file name must include the version number (+virtio-win-_version_.iso+). The Guest Tool is required for migrating Windows virtual machines.

. If you are using SSSD with single sign-on, reinstall `ipa-client` without configuring the OpenSSH client:[[Reinstalling_ipa_client]]
+
[options="nowrap" subs="+quotes,verbatim"]
----
# ipa-client-install --uninstall
# ipa-client-install --no-ssh
----
+
Otherwise, SSH will fail for the vdsm user. This issue cannot be resolved by modifying the configuration file because the file is restored during upgrades.

.Configuring CloudForms

. Install Red Hat CloudForms 4.7 on the Manager machine (see link:https://access.redhat.com/documentation/en-us/red_hat_cloudforms/4.7/html/installing_red_hat_cloudforms_on_red_hat_virtualization[Installing Red Hat CloudForms on Red Hat Virtualization]).

. Add VMware (see link:https://access.redhat.com/documentation/en-us/red_hat_cloudforms/4.7/html-single/managing_providers/#vmware_vcenter_providers[Adding a VMware vCenter Provider]) and Red Hat Virtualization (see https://access.redhat.com/documentation/en-us/red_hat_cloudforms/4.7/html-single/managing_providers/#adding_a_red_hat_virtualization_provider[Adding a Red Hat Virtualization Provider] in _Red Hat CloudForms Managing Providers_) as providers.
+
[NOTE]
====
Do not remove or change a provider (including refreshing hosts) before, during, or after migration because these actions cause errors in the infrastructure mappings and migration plans.
====

. Enable SmartState Analysis:

.. In the header bar, click menu:Administrator[Configuration].
.. In the left pane, in *Settings*, click menu:CFME Regions[Zones > Server] and select the CloudForms machine.
.. In the right pane, in the *Server* tab, set *SmartState Analysis* to *On* and click *Save*.

You are ready to xref:Configuring_the_conversion_hosts[configure the conversion hosts] in CloudForms.
